<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{fragments/layout/university-layout :: university-layout(~{::head}, ~{::main}, ~{::script})}">
<head>
    <title th:text="${school}">세종대학교 소개</title>
</head>
<main class="min-w-0 flex-1 py-6 px-0 md:px-6">
    <div th:replace="~{fragments/school/universityNavHeader :: universityNavHeader(${content.schoolDto.koreanName}+' 소개')}"></div>

    <div th:replace="~{fragments/school/universityIntroSection :: universityIntroSection(
    ${content.intro.title},
    ${content.intro.description},
    ${content.intro.advantages},
    ${content.homepageUrl},
    ${content.englishPageUrl},
    'https://www.sejong.ac.kr/_res/sejong/_share/img/sub-visual/sub-visual01.jpg'
)}"></div>

    <section class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">

        <div th:replace="~{fragments/school/universityBasicInfo :: universityBasicInfo(
    ${content.schoolDto.koreanName},
    ${content.schoolDto.englishName},
    ${content.basicInfo.builtAt},
    ${content.basicInfo.location},
    ${#strings.arrayJoin(content.basicInfo.feature, ' / ')}
)}">
        </div>


        <div th:replace="~{fragments/school/universityInfoCard :: universityInfoCard(
          'QS 세계 대학 순위',
          ${content.collegeRank},
          'QS World University Rankings 2026',
          '',
          '* TopUniversities 기준'
        )}"></div>


        <div th:replace="~{fragments/school/universityInfoCard :: universityLinkCard(
          '관련 홈페이지',
          ${content.homepageUrls.urlNames},
          ${content.homepageUrls.urls}
        )}"></div>
    </section>

    <!-- (옵션) 학과/프로그램 카드 미리보기: 필요 없으면 섹션 삭제 -->
    <section id="sejong-academics" class="bg-white rounded-lg shadow-sm p-6 mb-8">
        <!-- 헤더 + 검색 -->
        <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between mb-6">
            <h2 class="text-2xl font-bold text-gray-900">세종대학교 학사 학과/학부</h2>
            <div class="w-full md:w-80 relative">
                <i class="ri-search-line absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                <input id="deptSearch" type="text" placeholder="학과/학부 검색"
                       class="w-full pl-10 pr-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"/>
            </div>
        </div>

        <!-- 단과대학 탭 (가로 스크롤) -->
        <div id="collegeFilters" class="flex items-center gap-2 overflow-x-auto pb-2 mb-6">

            <!-- 전체 버튼 -->
            <button data-filter="all"
                    class="px-3 py-1.5 rounded-full bg-primary text-white text-sm whitespace-nowrap">
                전체
            </button>

            <!-- 학사 단과대 자동 생성 -->
            <button th:each="college : ${content.colleges}"
                    th:if="${college.type == 'UNDERGRADUATE'}"
                    th:attr="data-filter=${college.collegeName}"
                    class="px-3 py-1.5 rounded-full bg-gray-100 text-gray-700 text-sm whitespace-nowrap hover:bg-gray-200"
                    th:text="${college.collegeName}">
            </button>

        </div>


        <div id="collegeGrid" class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-5">

            <article class="border rounded-xl p-5 hover:shadow-md transition group"
                     th:each="college : ${content.colleges}"
                     th:if="${college.type == 'UNDERGRADUATE'}"
                     th:attr="data-college=${college.collegeName}">

                <header class="flex items-center justify-between mb-3">
                    <h3 class="text-lg font-semibold text-gray-900" th:text="${college.collegeName}">
                        단과대 이름
                    </h3>
                    <span class="text-xs text-gray-500" data-count
                          th:text="${#lists.size(college.departments)} + '개'">
                        —
                    </span>
                </header>

                <div class="flex flex-wrap gap-2" data-chips>
                    <span class="chip" data-dept
                          th:each="dept : ${college.departments}"
                          th:text="${dept}">
                        학과
                    </span>
                </div>

                <button class="show-more mt-3 hidden text-sm text-primary hover:underline" data-more>더보기</button>
            </article>

        </div>
    </section>

    <!--        석박사 과-->
    <section id="sejong-graduate" class="bg-white rounded-lg shadow-sm p-6 mb-8">
        <!-- 헤더 + 검색 -->
        <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between mb-6">
            <h2 class="text-2xl font-bold text-gray-900">세종대학교 대학원 과/학과</h2>
            <div class="w-full md:w-80 relative">
                <i class="ri-search-line absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                <input id="gradDeptSearch" type="text" placeholder="대학원 과/학과 검색"
                       class="w-full pl-10 pr-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"/>
            </div>
        </div>

        <!-- 단과대학 필터 -->
        <div id="gradCollegeFilters" class="flex items-center gap-2 overflow-x-auto pb-2 mb-6">

            <button data-filter="all"
                    class="px-3 py-1.5 rounded-full bg-primary text-white text-sm whitespace-nowrap">
                전체
            </button>

            <button th:each="college : ${content.colleges}"
                    th:if="${college.type == 'GRADUATE'}"
                    th:attr="data-filter=${college.collegeName}"
                    class="px-3 py-1.5 rounded-full bg-gray-100 text-gray-700 text-sm whitespace-nowrap hover:bg-gray-200"
                    th:text="${college.collegeName}">
            </button>

        </div>

        <!-- 카드 그리드 -->
        <div id="gradCollegeGrid" class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-5">

            <article class="border rounded-xl p-5 hover:shadow-md transition group"
                     th:each="college : ${content.colleges}"
                     th:if="${college.type == 'GRADUATE'}"
                     th:attr="data-college=${college.collegeName}">

                <header class="flex items-center justify-between mb-3">
                    <h3 class="text-lg font-semibold text-gray-900" th:text="${college.collegeName}">
                        대학원 단과대
                    </h3>
                    <span class="text-xs text-gray-500" data-count
                          th:text="${#lists.size(college.departments)} + '개'">
                —
            </span>
                </header>

                <div class="flex flex-wrap gap-2" data-chips>
            <span class="chip" data-dept
                  th:each="dept : ${college.departments}"
                  th:text="${dept}">
                대학원 학과
            </span>
                </div>

                <button class="show-more mt-3 hidden text-sm text-primary hover:underline" data-more>더보기</button>
            </article>

        </div>

    </section>
    <div th:replace="~{fragments/school/universityCampusMap :: universityCampus(
  '캠퍼스 위치',
  'https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3165.487797563933!2d127.07460067648073!3d37.5502822245114!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x357ca51c8b8e8a1d%3A0x9e16a07c0c8e7c2f!2z7ISc7Jq47Yq567OE7Iuc6rO17ZWZ6rWQIOyEnOyauOq0gA!5e0!3m2!1sko!2skr!4v1739000000000!5m2!1sko!2skr',
  '서울특별시 광진구 능동로 209 (05006) 세종대학교',
  'https://en.sejong.ac.kr/eng/Direction.do',
  '오시는 길 안내'
)}"></div>

</main>
<th:block th:fragment="script">
    <script type="module">
        const grid = document.getElementById('collegeGrid');
        const cards = Array.from(grid.querySelectorAll('article[data-college]'));
        const filters = document.getElementById('collegeFilters');
        const search = document.getElementById('deptSearch');

        // 칩 개수 > 10 이면 접기 처리
        cards.forEach(card => {
            const chipsWrap = card.querySelector('[data-chips]');
            const chips = Array.from(chipsWrap.querySelectorAll('.chip[data-dept]'));
            const moreBtn = card.querySelector('[data-more]');
            const countEl = card.querySelector('[data-count]');

            // 카운트 표시
            countEl.textContent = chips.length + '개';

            if (chips.length > 10) {
                chips.slice(10).forEach(ch => ch.classList.add('hidden'));
                moreBtn.classList.remove('hidden');
                moreBtn?.addEventListener('click', () => {
                    const hidden = chips.slice(10).some(ch => ch.classList.contains('hidden'));
                    chips.slice(10).forEach(ch => ch.classList.toggle('hidden'));
                    moreBtn.textContent = hidden ? '접기' : '더보기';
                });
            }
        });

        function applyFilter() {
            const activeBtn = filters.querySelector('button.active');
            const collegeFilter = activeBtn ? activeBtn.dataset.filter : 'all';
            const q = (search.value || '').trim().toLowerCase();

            cards.forEach(card => {
                const college = card.dataset.college;
                const chips = Array.from(card.querySelectorAll('.chip[data-dept]'));
                // 검색
                let hitChip = false;
                chips.forEach(c => {
                    const match = c.textContent.toLowerCase().includes(q);
                    c.style.opacity = q ? (match ? '1' : '0.25') : '1';
                    if (match) hitChip = true;
                });
                // 카드 표시 조건
                const passCollege = (collegeFilter === 'all') || (collegeFilter === college);
                const passSearch = q ? hitChip : true;
                card.style.display = (passCollege && passSearch) ? '' : 'none';
            });
        }

        // 초기 active
        filters?.querySelector('button[data-filter="all"]').classList.add('active');

        // 탭 클릭
        filters?.addEventListener('click', (e) => {
            const btn = e.target.closest('button[data-filter]');
            if (!btn) return;
            filters.querySelectorAll('button').forEach(b => {
                b.classList.remove('active', 'bg-primary', 'text-white');
                b.classList.add('bg-gray-100', 'text-gray-700');
            });
            btn.classList.add('active', 'bg-primary', 'text-white');
            btn.classList.remove('bg-gray-100', 'text-gray-700');
            applyFilter();
        });

        // 검색
        search?.addEventListener('input', applyFilter);
    </script>
    <script type="module">
        //대학원 모듈
        const grid = document.getElementById('gradCollegeGrid');
        const cards = Array.from(grid.querySelectorAll('article[data-college]'));
        const filters = document.getElementById('gradCollegeFilters');
        const search = document.getElementById('gradDeptSearch');

        // chip 접기
        cards.forEach(card => {
            const chipsWrap = card.querySelector('[data-chips]');
            const chips = Array.from(chipsWrap.querySelectorAll('.chip[data-dept]'));
            const moreBtn = card.querySelector('[data-more]');
            const countEl = card.querySelector('[data-count]');

            countEl.textContent = chips.length + '개';

            if (chips.length > 10) {
                chips.slice(10).forEach(ch => ch.classList.add('hidden'));
                moreBtn.classList.remove('hidden');
                moreBtn?.addEventListener('click', () => {
                    const hidden = chips.slice(10).some(ch => ch.classList.contains('hidden'));
                    chips.slice(10).forEach(ch => ch.classList.toggle('hidden'));
                    moreBtn.textContent = hidden ? '접기' : '더보기';
                });
            }
        });

        function applyFilter() {
            const activeBtn = filters.querySelector('button.active');
            const collegeFilter = activeBtn ? activeBtn.dataset.filter : 'all';
            const q = (search.value || '').trim().toLowerCase();

            cards.forEach(card => {
                const college = card.dataset.college;
                const chips = Array.from(card.querySelectorAll('.chip[data-dept]'));

                let hitChip = false;
                chips.forEach(c => {
                    const match = c.textContent.toLowerCase().includes(q);
                    c.style.opacity = q ? (match ? '1' : '0.25') : '1';
                    if (match) hitChip = true;
                });

                const passCollege = (collegeFilter === 'all') || (collegeFilter === college);
                const passSearch = q ? hitChip : true;
                card.style.display = (passCollege && passSearch) ? '' : 'none';
            });
        }

        // 초기 active
        filters?.querySelector('button[data-filter="all"]').classList.add('active');

        // 탭 클릭
        filters?.addEventListener('click', (e) => {
            const btn = e.target.closest('button[data-filter]');
            if (!btn) return;

            filters.querySelectorAll('button').forEach(b => {
                b.classList.remove('active', 'bg-primary', 'text-white');
                b.classList.add('bg-gray-100', 'text-gray-700');
            });

            btn.classList.add('active', 'bg-primary', 'text-white');
            btn.classList.remove('bg-gray-100', 'text-gray-700');
            applyFilter();
        });

        // 검색 바인딩
        search?.addEventListener('input', applyFilter);
    </script>
</th:block>
</html>
