<!DOCTYPE html>
<html th:replace="~{fragments/layout/base :: base(~{::head}, ~{::body})}" xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <title th:text="${postDto.post.title}"></title>
    <style>
        :where([class^="ri-"])::before {
            content: "\f3c2";
        }

        .nav-item.active {
            border-left: 4px solid #3b82f6;
            background-color: rgba(59, 130, 246, 0.1);
        }

        .nav-item:hover:not(.active) {
            background-color: rgba(59, 130, 246, 0.05);
        }

        .content-area {
            line-height: 1.8;
        }

        .content-area h3 {
            font-size: 1.125rem;
            font-weight: 600;
            margin: 1.5rem 0 1rem 0;
            color: #1f2937;
        }

        .content-area p {
            margin-bottom: 1rem;
            color: #4b5563;
        }

        .content-area ul {
            margin: 1rem 0;
            padding-left: 1.5rem;
        }

        .content-area li {
            margin-bottom: 0.5rem;
            color: #4b5563;
        }

        .content-area table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
        }

        .content-area th,
        .content-area td {
            border: 1px solid #e5e7eb;
            padding: 0.75rem;
            text-align: left;
        }

        .content-area th {
            background-color: #f9fafb;
            font-weight: 600;
        }
    </style>
    <style>
        :root {
            --header-h: 72px;
        }
    </style>
</head>
<body>
<div class="bg-gray-50 min-h-screen">
    <nav th:replace="~{fragments/common/nav-user :: nav-user}"></nav>
    <div class="container mx-auto px-4 py-8 pt-16 flex flex-col md:flex-row gap-8">
        <div th:replace="~{fragments/school/universityLeftSideBar :: school-left}"></div>
        <div class="min-w-0 flex-1 py-6 px-0 md:px-6">
            <div class="bg-white rounded shadow p-6">
                <div class="flex items-center gap-4 mb-6">
                    <a th:href="@{'/school/' + ${school} + '/board/' + ${boardId}}" data-readdy="true"
                       class="flex items-center gap-2 px-4 py-2 border border-gray-300 rounded hover:bg-gray-50 text-sm font-medium text-gray-700 whitespace-nowrap !rounded-button">
                        <div class="w-5 h-5 flex items-center justify-center">
                            <i class="ri-arrow-left-line"></i>
                        </div>
                        <span>返回列表</span>
                    </a>
                    <div class="text-sm text-gray-500">
                        <span>通知</span>
                        <span class="mx-2">></span>
                        <span class="text-gray-700" th:text="${postDto.post.title}"></span>
                    </div>
                </div>

                <div class="border-b border-gray-200 pb-6 mb-6">
                    <h1 class="text-2xl font-bold text-gray-800 mb-4" th:text="${postDto.post.title}">
                        title </h1>
                    <div class="flex flex-wrap items-center gap-6 text-sm text-gray-600">
                        <div class="flex items-center gap-2">
                            <div class="w-5 h-5 flex items-center justify-center">
                                <i class="ri-user-line"></i>
                            </div>
                            <!--                        <span th:text="${postDto.status}">管理员</span>-->
                            <span>管理员</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-5 h-5 flex items-center justify-center">
                                <i class="ri-calendar-line"></i>
                            </div>
                            <span th:text="${#temporals.format(postDto.post.createdAt, 'yyyy-MM-dd')}">2025-07-05</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-5 h-5 flex items-center justify-center">
                                <i class="ri-eye-line"></i>
                            </div>
                            <span th:text="${postDto.post.views}">634</span>
                        </div>
                    </div>
                </div>

                <div class="bg-blue-50 rounded p-4 mb-6" th:if="${postDto.file != null and !postDto.file.isEmpty()}">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="w-6 h-6 flex items-center justify-center text-primary">
                            <i class="ri-attachment-line"></i>
                        </div>
                        <h3 class="font-medium text-gray-800">附件</h3>
                    </div>
                    <div class="space-y-2">
                        <div th:each="file : ${postDto.file}"
                             class="flex items-center justify-between p-3 bg-white rounded border">
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 flex items-center justify-center bg-gray-100 rounded">
                                    <div class="w-5 h-5 flex items-center justify-center text-gray-600">
                                        <i class="ri-file-line"></i>
                                    </div>
                                </div>
                                <div>
                                    <p class="font-medium text-gray-800" th:text="${file.name}">文件名</p>
                                </div>
                            </div>
                            <a th:href="${file.url}" download
                               class="px-4 py-2 bg-primary text-white rounded hover:bg-primary/90 text-sm whitespace-nowrap !rounded-button">
                                下载
                            </a>
                        </div>
                    </div>
                </div>

                <div class="content-area" th:utext="${postDto.post.content}">
                    <!-- HTML 내용 출력 -->
                </div>

                <div class="border-t border-gray-200 pt-6 mt-8">
                    <div class="flex flex-col sm:flex-row justify-between gap-4">
                        <div class="flex-1">
                            <!-- ✅ id 추가: JS에서 :has() 대신 안정적으로 선택할 수 있도록(화면 영향 없음) -->
                            <div id="prevPostCard" class="p-4 border rounded hover:bg-gray-50 cursor-pointer">
                                <div class="flex items-center gap-3">
                                    <div class="w-8 h-8 flex items-center justify-center bg-gray-100 rounded">
                                        <div class="w-5 h-5 flex items-center justify-center text-gray-600">
                                            <i class="ri-arrow-up-line"></i>
                                        </div>
                                    </div>
                                    <div class="flex-1" th:if="${postDto.beforePost != null}">
                                        <p class="text-sm text-gray-500" th:attr="data-id=${postDto.beforePost.id}">上一篇</p>
                                        <p class="font-medium text-gray-800 hover:text-primary"
                                           th:text="${postDto.beforePost.title}"></p>
                                    </div>
                                    <div class="flex-1" th:if="${postDto.beforePost == null}">
                                        <p class="text-sm text-gray-500">上一篇</p>
                                        <p class="font-medium text-gray-800 hover:text-primary"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="flex-1">
                            <!-- ✅ id 추가: JS에서 :has() 대신 안정적으로 선택할 수 있도록(화면 영향 없음) -->
                            <div id="nextPostCard" class="p-4 border rounded hover:bg-gray-50 cursor-pointer">
                                <div class="flex items-center gap-3">
                                    <div class="w-8 h-8 flex items-center justify-center bg-gray-100 rounded">
                                        <div class="w-5 h-5 flex items-center justify-center text-gray-600">
                                            <i class="ri-arrow-down-line"></i>
                                        </div>
                                    </div>
                                    <div class="flex-1" th:if="${postDto.afterPost != null}">
                                        <p class="text-sm text-gray-500" th:attr="data-id=${postDto.afterPost.id}">下一篇</p>
                                        <p class="font-medium text-gray-800 hover:text-primary"
                                           th:text="${postDto.afterPost.title}"></p>
                                    </div>
                                    <div class="flex-1" th:if="${postDto.afterPost == null}">
                                        <p class="text-sm text-gray-500">下一篇</p>
                                        <p class="font-medium text-gray-800 hover:text-primary"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex justify-center mt-6">
                    <a th:href="@{'/school/' + ${school} + '/board/' + ${boardId}}" data-readdy="true"
                       class="px-6 py-3 bg-primary text-white rounded hover:bg-primary/90 font-medium whitespace-nowrap !rounded-button">
                        返回列表
                    </a>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-gray-800 text-white py-8 mt-12">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <h3 class="text-lg font-bold mb-4">大学国际项目</h3>
                    <p class="text-gray-300 text-sm">
                        我们提供培养全球人才的最佳教育环境。通过多样化的国际项目，与来自世界各国的学生共同成长。
                    </p>
                </div>
                <div>
                    <h3 class="text-lg font-bold mb-4">联系方式</h3>
                    <ul class="space-y-2 text-sm text-gray-300">
                        <li class="flex items-center gap-2">
                            <div class="w-5 h-5 flex items-center justify-center">
                                <i class="ri-map-pin-line"></i>
                            </div>
                            <span>首尔特别市 江南区 大学路 123</span>
                        </li>
                        <li class="flex items-center gap-2">
                            <div class="w-5 h-5 flex items-center justify-center">
                                <i class="ri-phone-line"></i>
                            </div>
                            <span>02-1234-5678</span>
                        </li>
                        <li class="flex items-center gap-2">
                            <div class="w-5 h-5 flex items-center justify-center">
                                <i class="ri-mail-line"></i>
                            </div>
                            <span>international@university.ac.kr</span>
                        </li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-bold mb-4">快速链接</h3>
                    <ul class="space-y-2 text-sm text-gray-300">
                        <li>
                            <a href="#" class="hover:text-primary">大学官网</a>
                        </li>
                        <li><a href="#" class="hover:text-primary">校历</a></li>
                        <li><a href="#" class="hover:text-primary">图书馆</a></li>
                        <li><a href="#" class="hover:text-primary">校园地图</a></li>
                        <li><a href="#" class="hover:text-primary">社区</a></li>
                    </ul>
                </div>
            </div>
            <div class="border-t border-gray-700 mt-8 pt-6 text-center text-sm text-gray-400">
                <p>© 2025 大学国际项目. All rights reserved.</p>
            </div>
        </div>
    </footer>
</div>

<script id="downloadScript" type="module">
    // ✅ (한국어) 기존 코드 문제:
    // - "다운로드"는 <button>이 아니라 <a download> 링크인데,
    //   button만 찾고 있어서 이벤트가 거의 안 붙습니다.
    // ✅ 개선:
    // - download 속성이 있는 <a>를 기준으로 잡아서 언어(다운로드/下载)와 무관하게 동작하게 변경했습니다.
    const downloadButtons = Array.from(document.querySelectorAll('a[download]'));

    downloadButtons.forEach((btn) => {
        btn?.addEventListener("click", function () {
            // (한국어) 다운로드 행에서 파일명을 찾아 알림에 사용
            const fileName =
                this.closest(".flex.items-center.justify-between")
                    ?.querySelector(".font-medium")
                    ?.textContent?.trim() || "文件";
            alert(`${fileName} 文件将开始下载。`);
            // (한국어) 기본 다운로드 동작은 그대로 진행되도록 preventDefault()는 하지 않습니다.
        });
    });
</script>

<!-- ✅ th:inline="javascript" 추가: [[${...}]] 치환이 실제로 적용되려면 반드시 필요 -->
<script id="navigationScript" type="module" th:inline="javascript">
    // ✅ (한국어) 기존 코드 문제:
    // - th:inline="javascript"가 없으면 [[${school}]] / [[${boardId}]] 가 실제 값으로 치환되지 않고
    //   문자열 그대로 남아서 URL이 깨질 수 있습니다.
    // ✅ 개선:
    // - th:inline 추가 + 문자열/숫자 타입 안전하게 주입 방식 변경

    const prevPost = document.getElementById("prevPostCard");
    const nextPost = document.getElementById("nextPostCard");

    const school = /*[[${school}]]*/ "";
    const boardId = /*[[${boardId}]]*/ 0;

    if (prevPost) {
        const pTag = prevPost.querySelector("p[data-id]");
        if (pTag && pTag.hasAttribute("data-id")) {
            const postId = pTag.dataset.id;
            prevPost?.addEventListener("click", function () {
                window.location.href = `/school/${school}/board/${boardId}/post/${postId}`;
            });
        }
    }

    if (nextPost) {
        const pTag = nextPost.querySelector("p[data-id]");
        if (pTag && pTag.hasAttribute("data-id")) {
            const postId = pTag.dataset.id;
            nextPost?.addEventListener("click", function () {
                window.location.href = `/school/${school}/board/${boardId}/post/${postId}`;
            });
        }
    }
</script>
</body>
</html>
