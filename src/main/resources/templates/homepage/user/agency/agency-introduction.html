<!DOCTYPE html>
<html th:replace="~{fragments/layout/main-layout :: main-layout(~{::head}, ~{::body}, ~{::script})}"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <title>유학원 정보 - 유학 정보 플랫폼</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.5.0/echarts.min.js"></script>
    <style>
        :where([class^="ri-"])::before {
            content: "\f3c2";
        }
    </style>
</head>

<body>
<!-- 메인 컨텐츠 -->
<main>
    <!-- 헤더 섹션 -->
    <div class="bg-white shadow-sm">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900">유학원 찾기</h1>
                    <p class="mt-2 text-lg text-gray-600">
                        전문적인 유학 상담을 제공하는 신뢰할 수 있는 유학원을
                        찾아보세요.
                    </p>
                </div>
                <!--                <div class="mt-4 md:mt-0 flex space-x-2">-->
                <!--                    <button-->
                <!--                            id="list-view-btn"-->
                <!--                            class="bg-primary text-white px-4 py-2 !rounded-button whitespace-nowrap flex items-center"-->
                <!--                    >-->
                <!--                        <div class="w-5 h-5 mr-1 flex items-center justify-center">-->
                <!--                            <i class="ri-list-check"></i>-->
                <!--                        </div>-->
                <!--                        목록 보기-->
                <!--                    </button>-->
                <!--                    <button-->
                <!--                            id="map-view-btn"-->
                <!--                            class="bg-white text-gray-700 border border-gray-300 px-4 py-2 !rounded-button whitespace-nowrap flex items-center"-->
                <!--                    >-->
                <!--                        <div class="w-5 h-5 mr-1 flex items-center justify-center">-->
                <!--                            <i class="ri-map-pin-line"></i>-->
                <!--                        </div>-->
                <!--                        지도 보기-->
                <!--                    </button>-->
                <!--                </div>-->
            </div>
        </div>
    </div>
    <!-- 필터 섹션 -->
    <div class="bg-white shadow-sm mt-4">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="flex items-center space-x-4">
                <!-- 검색바 -->
                <div class="relative flex-grow">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <div class="w-5 h-5 text-gray-400 flex items-center justify-center">
                            <i class="ri-search-line"></i>
                        </div>
                    </div>
                    <input
                            type="text"
                            id="searchKeyword"
                            th:placeholder="${keyword}"
                            class="pl-10 pr-4 py-2 w-full border border-gray-300 !rounded-button focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary text-sm"
                    />
                </div>
                <!-- 지역 필터 -->
                <div class="relative inline-block text-left" id="region-filter">
                    <button
                            type="button"
                            class="inline-flex justify-between items-center w-full px-4 py-2 border border-gray-300 !rounded-button bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary"
                            id="region-menu-button"
                    >
                        <span>지역</span>
                        <span class="w-5 h-5 ml-2 flex items-center justify-center">
                            <i class="ri-arrow-down-s-line"></i>
                        </span>
                    </button>
                    <div
                            class="hidden origin-top-right absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none z-10"
                            id="region-menu"
                    >
                        <div class="py-1" role="none">
                            <!--Todo: 중국 지역 Spring 상수로 지정-->
                            <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                北京市
                            </button>
                            <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                天津市
                            </button>
                            <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                上海市
                            </button>
                            <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                重庆市
                            </button>
                            <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                河北省
                            </button>
                            <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                山西省
                            </button>
                            <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                辽宁省
                            </button>
                            <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                吉林省
                            </button>
                            <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                黑龙江省
                            </button>
                            <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                江苏省
                            </button>
                            <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                浙江省
                            </button>
                            <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                安徽省
                            </button>
                            <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                福建省
                            </button>
                            <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                江西省
                            </button>
                            <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                山东省
                            </button>
                            <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                河南省
                            </button>
                            <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                湖北省
                            </button>
                            <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                湖南省
                            </button>
                            <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                广东省
                            </button>
                            <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                海南省
                            </button>
                            <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                四川省
                            </button>
                            <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                贵州省
                            </button>
                            <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                云南省
                            </button>
                            <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                陕西省
                            </button>
                            <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                甘肃省
                            </button>
                            <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                青海省
                            </button>
                            <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                内蒙古自治区
                            </button>
                            <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                广西壮族自治区
                            </button>
                            <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                西藏自治区
                            </button>
                            <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                宁夏回族自治区
                            </button>
                            <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                新疆维吾尔自治区
                            </button>
                            <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                香港特别行政区
                            </button>
                            <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                澳门特别行政区
                            </button>
                        </div>
                    </div>
                </div>
                <div>
                    <!--                    검색 버튼-->
                    <button id="searchButton" type="submit"
                            class="bg-primary text-white px-4 py-2 rounded-button whitespace-nowrap flex items-center">
                        검색
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- 목록 보기 섹션 -->
    <div id="list-view" class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="mb-6 flex justify-between items-center">
            <h2 class="text-xl font-semibold text-gray-900">
                총 <span class="text-primary" th:text="${agencyDto.totalElements}">0</span>개의 유학원
            </h2>
        </div>
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
            <th:block th:each="agency : ${agencyDto}">
                <div th:replace="~{fragments/agency/agencyCard :: card(${agency})}"></div>
            </th:block>
        </div>

<!--        <div th:replace="~{fragments/common/pagination :: pagination(page=${agencyDto}, maxButtons=5)}"></div>-->

        <!-- Todo: Pagination 컴포넌트 구현하기-->
        <div class="mt-8 flex justify-center items-center space-x-2" th:if="${agencyDto.totalPages > 0}">
            <!-- 이전 버튼 -->
            <a th:if="${agencyDto.hasPrevious()}"
               th:href="@{/agency/list(page=${agencyDto.number - 1})}"
               class="px-3 py-1 rounded border text-sm text-gray-700 hover:bg-gray-100">이전</a>

            <!-- 페이지 번호 -->
            <span th:each="pageNum : ${#numbers.sequence(0, agencyDto.totalPages - 1)}">
                <a th:href="@{/agency/list(page=${pageNum}, keyword=${keyword}, region=${region})}"
                   th:text="${pageNum + 1}"
                   th:class="${pageNum == agencyDto.number} ?
                             'px-3 py-1 rounded bg-primary text-white text-sm' :
                             'px-3 py-1 rounded border text-sm text-gray-700 hover:bg-gray-100'">
                </a>
            </span>
            <!-- 다음 버튼 -->
            <a th:if="${agencyDto.hasNext()}"
               th:href="@{/agency/list(page=${agencyDto.number + 1})}"
               class="px-3 py-1 rounded border text-sm text-gray-700 hover:bg-gray-100">다음</a>
        </div>

    </div>
</main>
</body>

<th:block th:fragment="script">
    <!-- 필터 드롭다운 스크립트 -->
    <script id="filter-dropdown-script">
        document.addEventListener("DOMContentLoaded", function () {
            const regionMenuButton = document.getElementById("region-menu-button");
            const regionMenu = document.getElementById("region-menu");
            regionMenuButton.addEventListener("click", function () {
                regionMenu.classList.toggle("hidden");
            });

            const regionButtons = regionMenu.querySelectorAll("button");
            regionButtons.forEach((button) => {
                button.addEventListener("click", function () {
                    regionMenuButton.querySelector("span").textContent = this.textContent;
                    regionMenu.classList.add("hidden");
                });
            });
        });
    </script>
    <!-- 지도/목록 전환 스크립트 -->
    <script id="view-toggle-script">
        document.addEventListener("DOMContentLoaded", function () {
            const listViewBtn = document.getElementById("list-view-btn");
            const mapViewBtn = document.getElementById("map-view-btn");
            const listView = document.getElementById("list-view");
            const mapView = document.getElementById("map-view");
            listViewBtn.addEventListener("click", function () {
                listView.classList.remove("hidden");
                mapView.classList.add("hidden");
                listViewBtn.classList.remove(
                    "bg-white",
                    "text-gray-700",
                    "border",
                    "border-gray-300",
                );
                listViewBtn.classList.add("bg-primary", "text-white");
                mapViewBtn.classList.remove("bg-primary", "text-white");
                mapViewBtn.classList.add(
                    "bg-white",
                    "text-gray-700",
                    "border",
                    "border-gray-300",
                );
            });
            mapViewBtn.addEventListener("click", function () {
                mapView.classList.remove("hidden");
                listView.classList.add("hidden");
                mapViewBtn.classList.remove(
                    "bg-white",
                    "text-gray-700",
                    "border",
                    "border-gray-300",
                );
                mapViewBtn.classList.add("bg-primary", "text-white");
                listViewBtn.classList.remove("bg-primary", "text-white");
                listViewBtn.classList.add(
                    "bg-white",
                    "text-gray-700",
                    "border",
                    "border-gray-300",
                );
            });
        });
    </script>
    <script id="searchApi">
        document.addEventListener("DOMContentLoaded", function () {
            let selectedRegion = "";

            // 지역 버튼 클릭 시 해당 버튼의 텍스트를 region 값으로 사용
            document.querySelectorAll("#region-menu button").forEach(button => {
                button.addEventListener("click", () => {
                    selectedRegion = button.textContent.trim(); // ← 여기가 핵심

                    // 버튼에 표시된 텍스트 바꾸기
                    document.querySelector("#region-menu-button span").textContent = selectedRegion;

                    // 드롭다운 닫기
                    document.getElementById("region-menu").classList.add("hidden");
                });
            });

            // 검색 버튼 클릭 시 조건 객체로 페이지 리로딩
            document.getElementById("searchButton").addEventListener("click", function (e) {
                e.preventDefault();

                const keyword = document.getElementById("searchKeyword")?.value.trim() || "";

                const params = new URLSearchParams();
                if (keyword) params.append("keyword", keyword);
                if (selectedRegion) params.append("region", selectedRegion);

                window.location.href = `/agency/list?${params.toString()}`;
            });
        });
    </script>
</th:block>
</html>
