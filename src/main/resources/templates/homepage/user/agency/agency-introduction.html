<!DOCTYPE html>
<html th:replace="~{fragments/layout/main-layout :: main-layout(~{::head}, ~{::body}, ~{::script})}"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <title>유학원 정보 - 유학 정보 플랫폼</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.5.0/echarts.min.js"></script>
    <style>
        :where([class^="ri-"])::before {
            content: "\f3c2";
        }
    </style>
</head>

<body>
<!-- 메인 컨텐츠 -->
<main>
    <!-- 헤더 섹션 -->
    <div class="bg-white shadow-sm">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900">유학원 찾기</h1>
                    <p class="mt-2 text-lg text-gray-600">
                        전문적인 유학 상담을 제공하는 신뢰할 수 있는 유학원을
                        찾아보세요. </p>
                </div>
                <!--                <div class="mt-4 md:mt-0 flex space-x-2">-->
                <!--                    <button-->
                <!--                            id="list-view-btn"-->
                <!--                            class="bg-primary text-white px-4 py-2 !rounded-button whitespace-nowrap flex items-center"-->
                <!--                    >-->
                <!--                        <div class="w-5 h-5 mr-1 flex items-center justify-center">-->
                <!--                            <i class="ri-list-check"></i>-->
                <!--                        </div>-->
                <!--                        목록 보기-->
                <!--                    </button>-->
                <!--                    <button-->
                <!--                            id="map-view-btn"-->
                <!--                            class="bg-white text-gray-700 border border-gray-300 px-4 py-2 !rounded-button whitespace-nowrap flex items-center"-->
                <!--                    >-->
                <!--                        <div class="w-5 h-5 mr-1 flex items-center justify-center">-->
                <!--                            <i class="ri-map-pin-line"></i>-->
                <!--                        </div>-->
                <!--                        지도 보기-->
                <!--                    </button>-->
                <!--                </div>-->
            </div>
        </div>
    </div>
    <!-- 필터 섹션 -->
    <div class="bg-white shadow-sm mt-4">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="flex items-center space-x-4">
                <!-- 검색바 -->
                <div class="relative flex-grow">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <div class="w-5 h-5 text-gray-400 flex items-center justify-center">
                            <i class="ri-search-line"></i>
                        </div>
                    </div>
                    <input type="text" id="searchKeyword" th:placeholder="${keyword}"
                           class="pl-10 pr-4 py-2 w-full border border-gray-300 !rounded-button focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary text-sm"/>
                </div>
                <!-- 지역 필터 -->
                <div class="relative inline-block text-left" id="region-filter">
                    <button id="region-menu-button" type="button"
                            class="inline-flex justify-between items-center w-full px-4 py-2 border border-gray-300 !rounded-button bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                        <span>지역</span>
                        <span class="w-5 h-5 ml-2 flex items-center justify-center">
                            <i class="ri-arrow-down-s-line"></i>
                        </span>
                    </button>
                    <div class="hidden origin-top-right absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none z-10"
                         id="region-menu">
                        <div class="py-1" role="none">
                            <!--TODO: 중국 지역 Spring 상수로 지정-->
                            <!--                            <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">-->
                            <!--                                北京市-->
                            <!--                            </button>-->
                        </div>
                    </div>
                </div>
                <div>
                    <!--                    검색 버튼-->
                    <button id="searchButton" type="submit"
                            class="bg-primary text-white px-4 py-2 rounded-button whitespace-nowrap flex items-center">
                        검색
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- 목록 보기 섹션 -->
    <div id="list-view" class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="mb-6 flex justify-between items-center">
            <h2 class="text-xl font-semibold text-gray-900">
                총 <span class="text-primary" th:text="${agencyDto.totalElements}">0</span>개의 유학원 </h2>
        </div>
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
            <th:block th:each="agency : ${agencyDto}">
                <div th:replace="~{fragments/agency/agencyCard :: card(${agency})}"></div>
            </th:block>
        </div>

        <!--        <div th:replace="~{fragments/common/pagination :: pagination(page=${agencyDto}, maxButtons=5)}"></div>-->

        <!-- TODO: Pagination 컴포넌트 구현하기-->
        <div class="mt-8 flex justify-center items-center space-x-2" th:if="${agencyDto.totalPages > 0}">
            <!-- 이전 버튼 -->
            <a th:if="${agencyDto.hasPrevious()}" th:href="@{/agency/list(page=${agencyDto.number - 1})}"
               class="px-3 py-1 rounded border text-sm text-gray-700 hover:bg-gray-100">이전</a>

            <!-- 페이지 번호 -->
            <span th:each="pageNum : ${#numbers.sequence(0, agencyDto.totalPages - 1)}">
                <a th:href="@{/agency/list(page=${pageNum}, keyword=${keyword}, region=${region})}"
                   th:text="${pageNum + 1}" th:class="${pageNum == agencyDto.number} ?
                             'px-3 py-1 rounded bg-primary text-white text-sm' :
                             'px-3 py-1 rounded border text-sm text-gray-700 hover:bg-gray-100'">
                </a>
            </span>
            <!-- 다음 버튼 -->
            <a th:if="${agencyDto.hasNext()}" th:href="@{/agency/list(page=${agencyDto.number + 1})}"
               class="px-3 py-1 rounded border text-sm text-gray-700 hover:bg-gray-100">다음</a>
        </div>

    </div>
</main>
</body>

<th:block th:fragment="script">
    <!-- 필터 드롭다운 스크립트 -->
    <script id="filter-dropdown-script" type="module">
        const regionMenuButton = document.getElementById("region-menu-button");
        const regionMenuText = regionMenuButton?.querySelector("span");
        const regionMenu = document.getElementById("region-menu");
        const regionMenuList = regionMenu.querySelector("div");

        const REGIONS = ["北京市", "天津市", "上海市", "重庆市", "河北省", "山西省", "辽宁省", "吉林省", "黑龙江省", "江苏省", "浙江省", "安徽省", "福建省", "江西省", "山东省", "河南省", "湖北省", "湖南省", "广东省", "海南省", "四川省", "贵州省", "云南省", "陕西省", "甘肃省", "青海省", "内蒙古自治区", "广西壮族自治区", "西藏自治区", "宁夏回族自治区", "新疆维吾尔自治区", "香港特别行政区", "澳门特别行政区"]

        regionMenuButton.addEventListener("click", function () {
            regionMenu.classList.toggle("hidden");
        });

        // 중국 지역 selectbox 동적으로 추가
        const fragment = document.createDocumentFragment();
        const BUTTON_CLASSES = "block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100".split(" ");
        REGIONS.forEach((regionName) => {
            const button = document.createElement("button");
            button.classList.add(...BUTTON_CLASSES);
            button.innerText = regionName;
            button.addEventListener("click", function () {
                regionMenuText.textContent = this.textContent;
                regionMenu.classList.add("hidden");
            });
            fragment.append(button);
        });
        regionMenuList.append(fragment);
    </script>
    <!-- 지도/목록 전환 스크립트 -->
    <script id="view-toggle-script" type="module">
        const listViewBtn = document.getElementById("list-view-btn");
        const mapViewBtn = document.getElementById("map-view-btn");
        const listView = document.getElementById("list-view");
        const mapView = document.getElementById("map-view");
        const SelectedClass = ["bg-white", "text-gray-700", "border", "border-gray-300"]

        listViewBtn?.addEventListener("click", function () {
            listView?.classList.remove("hidden");
            mapView?.classList.add("hidden");
            listViewBtn?.classList.remove(...SelectedClass);
            listViewBtn?.classList.add("bg-primary", "text-white");
            mapViewBtn?.classList.remove("bg-primary", "text-white");
            mapViewBtn?.classList.add(...SelectedClass);
        });
        mapViewBtn?.addEventListener("click", function () {
            mapView?.classList.remove("hidden");
            listView?.classList.add("hidden");
            mapViewBtn?.classList.remove(...SelectedClass);
            mapViewBtn?.classList.add("bg-primary", "text-white");
            listViewBtn?.classList.remove("bg-primary", "text-white");
            listViewBtn?.classList.add(...SelectedClass);
        });
    </script>
    <script id="searchApi" type="module">
        let selectedRegion = "";

        // 지역 버튼 클릭 시 해당 버튼의 텍스트를 region 값으로 사용
        document.querySelectorAll("#region-menu button").forEach(button => {
            button.addEventListener("click", () => {
                selectedRegion = button.textContent.trim(); // ← 여기가 핵심

                // 버튼에 표시된 텍스트 바꾸기
                // document.querySelector("#region-menu-button span").textContent = selectedRegion;

                // 드롭다운 닫기
                // document.getElementById("region-menu").classList.add("hidden");
            });
        });

        // 검색 버튼 클릭 시 조건 객체로 페이지 리로딩
        document.getElementById("searchButton").addEventListener("click", function (e) {
            e.preventDefault();

            const keyword = document.getElementById("searchKeyword")?.value.trim() || "";

            const params = new URLSearchParams();
            if (keyword) params.append("keyword", keyword);
            if (selectedRegion) params.append("region", selectedRegion);

            Turbo.visit(`/agency/list?${params.toString()}`);
        });
    </script>
</th:block>
</html>
