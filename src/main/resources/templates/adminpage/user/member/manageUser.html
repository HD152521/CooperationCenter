<!DOCTYPE html>
<html th:replace="~{fragments/layout/base :: base(~{::head}, ~{::body})}" xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <title>사용자 관리 - 관리자 대시보드</title>
    <style>
        :where([class^="ri-"])::before {
            content: "\f3c2";
        }

        .admin-card {
            background: linear-gradient(145deg, #2C2C3A, #232331);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .table-header {
            background: linear-gradient(135deg, #343446, #2A2A3C);
        }

        .table-row:hover {
            background: rgba(52, 152, 219, 0.1);
        }

        .status-badge {
            backdrop-filter: blur(10px);
        }

        .custom-switch {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 24px;
        }

        .custom-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #4a5568;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #3498DB;
        }

        input:checked + .slider:before {
            transform: translateX(20px);
        }

        .custom-checkbox {
            position: relative;
            display: inline-block;
            width: 18px;
            height: 18px;
        }

        .custom-checkbox input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .checkmark {
            position: absolute;
            top: 0;
            left: 0;
            height: 18px;
            width: 18px;
            background-color: #4a5568;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .custom-checkbox:hover input ~ .checkmark {
            background-color: #5a6578;
        }

        .custom-checkbox input:checked ~ .checkmark {
            background-color: #3498DB;
        }

        .checkmark:after {
            content: "";
            position: absolute;
            display: none;
        }

        .custom-checkbox input:checked ~ .checkmark:after {
            display: block;
        }

        .custom-checkbox .checkmark:after {
            left: 6px;
            top: 2px;
            width: 5px;
            height: 10px;
            border: solid white;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
        }
    </style>
</head>
<body>
<div class="bg-gradient-to-br from-gray-900 via-slate-800 to-gray-900 min-h-screen text-gray-100">
    <div class="flex">
        <aside th:replace="~{adminpage/common/leftSide :: leftSide}"></aside>
        <main class="flex-1 p-8">
            <header class="mb-8">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-3xl font-bold text-white">사용자 관리</h1>
                        <p class="text-gray-400 mt-2">
                            전체 사용자 현황을 관리하고 모니터링하세요 </p>
                    </div>
                    <div class="flex items-center space-x-4">
                        <!--                    <div class="bg-red-500 text-white px-3 py-1 rounded-full text-sm">-->
                        <!--                        <div-->
                        <!--                                class="w-4 h-4 inline-flex items-center justify-center mr-1"-->
                        <!--                        >-->
                        <!--                            <i class="ri-notification-line ri-sm"></i>-->
                        <!--                        </div>-->
                        <!--                        5개 대기-->
                        <!--                    </div>-->
                        <div class="text-right">
                            <p class="text-white font-medium">김관리자</p>
                            <p class="text-sm text-gray-400">최고 관리자</p>
                        </div>
                    </div>
                </div>
            </header>
            <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6 mb-8">
                <div class="admin-card rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-400 text-sm">전체 사용자</p>
                            <p class="text-3xl font-bold text-white mt-2" th:text="${userDto.totalUser}">2,847</p>
                        </div>
                        <div class="w-12 h-12 bg-primary bg-opacity-20 rounded-lg flex items-center justify-center">
                            <i class="ri-user-line text-primary text-xl"></i>
                        </div>
                    </div>
                </div>
                <div class="admin-card rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-400 text-sm">활성 사용자</p>
                            <p class="text-3xl font-bold text-white mt-2" th:text="${userDto.activeUser}">2,156</p>
                        </div>
                        <div class="w-12 h-12 bg-green-500 bg-opacity-20 rounded-lg flex items-center justify-center">
                            <i class="ri-user-check-line text-green-400 text-xl"></i>
                        </div>
                    </div>
                </div>
                <div class="admin-card rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-400 text-sm">이번 달 신규</p>
                            <p class="text-3xl font-bold text-white mt-2" th:text="${userDto.newUser}">234</p>
                        </div>
                        <div class="w-12 h-12 bg-blue-500 bg-opacity-20 rounded-lg flex items-center justify-center">
                            <i class="ri-user-add-line text-blue-400 text-xl"></i>
                        </div>
                    </div>
                </div>
                <div class="admin-card rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-400 text-sm">승인 대기</p>
                            <p class="text-3xl font-bold text-white mt-2" th:text="${userDto.pendingUser}">5</p>
                        </div>
                        <div class="w-12 h-12 bg-red-500 bg-opacity-20 rounded-lg flex items-center justify-center">
                            <i class="ri-user-unfollow-line text-red-400 text-xl"></i>
                        </div>
                    </div>
                </div>
            </div>
            <div class="admin-card rounded-xl p-6 mb-8">
                <div class="flex flex-col lg:flex-row lg:items-center gap-4 mb-6"><!-- justify-between 제거 -->

                    <!-- 왼쪽: 인풋 + 셀렉트들 -->
                    <div class="flex flex-col md:flex-row md:items-center gap-3 md:flex-1"><!-- md:flex-1로 남는 공간 확보 -->
                        <div class="relative md:flex-1 min-w-0"><!-- 인풋이 가로로 확장 -->
                            <input type="text" id="search-input" placeholder="이름 또는 이메일로 검색"
                                   class="bg-gray-700 text-white pl-10 pr-4 py-2 rounded-lg text-sm border-none w-full"
                                   th:value="${condition.keyword}"/>
                            <div class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 flex items-center justify-center text-gray-400">
                                <i class="ri-search-line"></i>
                            </div>
                        </div>

                        <select id="status-filter"
                                class="bg-gray-700 text-white px-3 py-2 rounded-lg text-sm border-none pr-8 shrink-0">
                            <option value="" th:selected="${condition.status} == null or condition.status == ''">전체 상태
                            </option>
                            <option value="APPROVED" th:selected="${condition.status} == 'APPROVED'">활성</option>
                            <option value="PENDING" th:selected="${condition.status} == 'PENDING'">비활성</option>
                        </select>

                        <select id="date-filter"
                                class="bg-gray-700 text-white px-3 py-2 rounded-lg text-sm border-none pr-8 shrink-0">
                            <option value="" th:selected="${condition.date} == null or condition.date == ''">전체 기간
                            </option>
                            <option value="7" th:selected="${condition.date} == '7'">최근 7일</option>
                            <option value="30" th:selected="${condition.date} == '30'">최근 30일</option>
                            <option value="90" th:selected="${condition.date} == '90'">최근 90일</option>
                        </select>
                    </div>

                    <!-- 오른쪽: 검색 버튼 -->
                    <div class="flex items-center space-x-4 shrink-0 md:ml-3">
                        <button id="filter-btn"
                                class="px-4 py-2 bg-primary text-white rounded-button hover:bg-blue-600 transition-colors whitespace-nowrap">
                        <span class="w-4 h-4 inline-flex items-center justify-center mr-2">
                          <i class="ri-search-line"></i>
                        </span>
                            검색
                        </button>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                        <tr class="table-header text-left">
                            <th class="p-3 text-sm font-medium text-gray-300">
                                <label class="custom-checkbox">
                                    <input type="checkbox" id="select-all"/>
                                    <span class="checkmark"></span>
                                </label>
                            </th>
                            <th class="p-3 text-sm font-medium text-gray-300">이름</th>
                            <th class="p-3 text-sm font-medium text-gray-300">이메일</th>
                            <th class="p-3 text-sm font-medium text-gray-300">가입일</th>
                            <th class="p-3 text-sm font-medium text-gray-300">
                                승인 날짜
                            </th>
                            <th class="p-3 text-sm font-medium text-gray-300">상태</th>
                            <th class="p-3 text-sm font-medium text-gray-300">작업</th>
                        </tr>
                        </thead>
                        <tbody id="user-table-body">
                        <tr class="table-row border-b border-gray-700" th:each="user : ${userDto.users}">
                            <td class="p-3">
                                <label class="custom-checkbox">
                                    <input type="checkbox" class="user-checkbox"/>
                                    <span class="checkmark"></span>
                                </label>
                            </td>
                            <td class="p-3 text-white" th:text="${user.userName}">이름</td>
                            <td class="p-3 text-gray-300" th:text="${user.userEmail}">이메일</td>
                            <td class="p-3 text-gray-400"
                                th:text="${#temporals.format(user.userCreatedAt, 'yyyy-MM-dd')}">
                                가입일
                            </td>
                            <td class="p-3 text-gray-300"
                                th:text="${#temporals.format(user.userApprovedAt, 'yyyy-MM-dd')}">
                                로그인
                            </td>
                            <td class="p-3">
                                <label class="custom-switch">
                                    <input type="checkbox" th:checked="${user.isApproval}"/>
                                    <span class="slider"></span>
                                </label>
                            </td>
                            <td class="p-3">
                                <div class="flex space-x-2">
                                    <button class="px-3 py-1 bg-blue-600 text-white text-sm rounded-button hover:bg-blue-500 transition-colors whitespace-nowrap view-details-btn">
                                        <div class="w-3 h-3 inline-flex items-center justify-center mr-1">
                                            <i class="ri-file-list-line"></i>
                                        </div>
                                        상세
                                    </button>
                                    <button class="px-3 py-1 bg-gray-600 text-white text-sm rounded-button hover:bg-gray-500 transition-colors whitespace-nowrap edit-btn">
                                        <div class="w-3 h-3 inline-flex items-center justify-center mr-1">
                                            <i class="ri-edit-line"></i>
                                        </div>
                                        편집
                                    </button>
                                    <button class="px-3 py-1 bg-red-600 text-white text-sm rounded-button hover:bg-red-500 transition-colors whitespace-nowrap delete-btn">
                                        <div class="w-3 h-3 inline-flex items-center justify-center mr-1">
                                            <i class="ri-delete-bin-line"></i>
                                        </div>
                                        삭제
                                    </button>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div class="flex items-center justify-between mt-6">
                    <div class="flex items-center space-x-4">
                        <!--                    <select-->
                        <!--                            id="per-page"-->
                        <!--                            class="bg-gray-700 text-white px-3 py-2 rounded-lg text-sm border-none pr-8"-->
                        <!--                    >-->
                        <!--                        <option value="10">10개씩 보기</option>-->
                        <!--                        <option value="25">25개씩 보기</option>-->
                        <!--                        <option value="50">50개씩 보기</option>-->
                        <!--                        <option value="100">100개씩 보기</option>-->
                        <!--                    </select>-->
                        <!--                    <p class="text-sm text-gray-400"-->
                        <!--                       th:text="'총 ' + ${userDto.totalUser} + '명 중 ' + (${userDto.users.number} * ${userDto.users.size} + 1) + '~' + ${T(java.lang.Math).min((${userDto.users.number} + 1) * ${userDto.users.size}, ${userDto.users.totalElements})} + '명 표시'">-->
                        <!--                        총 0명 중 1~10명 표시-->
                        <!--                    </p>-->
                    </div>
                    <div class="flex items-center space-x-2 mt-6 justify-center">
                        <!-- 이전 버튼 -->
                        <a th:href="@{/admin/user(page=${userDto.users.number - 1}, keyword=${condition.keyword}, status=${condition.status},date=${condition.date})}"
                           th:classappend="${userDto.users.first} ? 'pointer-events-none opacity-50' : ''"
                           class="px-3 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-colors">
                            <div class="w-4 h-4 flex items-center justify-center">
                                <i class="ri-arrow-left-line"></i>
                            </div>
                        </a>

                        <!-- 페이지 번호 -->
                        <th:block th:each="i : ${#numbers.sequence(0, userDto.users.totalPages - 1)}">
                            <a th:href="@{/admin/user(page=${i}, keyword=${condition.keyword}, status=${condition.status},date=${condition.date})}"
                               th:class="${i == userDto.users.number} ? 'px-3 py-2 bg-primary text-white rounded-lg' : 'px-3 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-colors'"
                               th:text="${i + 1}">
                            </a>
                        </th:block>

                        <!-- 다음 버튼 -->
                        <a th:href="@{/admin/user(page=${userDto.users.number + 1}, keyword=${condition.keyword}, status=${condition.status},date=${condition.date})}"
                           th:classappend="${userDto.users.last} ? 'pointer-events-none opacity-50' : ''"
                           class="px-3 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-colors">
                            <div class="w-4 h-4 flex items-center justify-center">
                                <i class="ri-arrow-right-line"></i>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <div id="edit-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-gray-800 rounded-xl p-6 max-w-md w-full mx-4">
            <h3 class="text-xl font-bold text-white mb-4">사용자 편집</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-gray-300 text-sm mb-2">이름</label>
                    <input type="text" id="edit-name"
                           class="w-full bg-gray-700 text-white px-3 py-2 rounded-lg border-none"/>
                </div>
                <div>
                    <label class="block text-gray-300 text-sm mb-2">이메일</label>
                    <input type="email" id="edit-email"
                           class="w-full bg-gray-700 text-white px-3 py-2 rounded-lg border-none"/>
                </div>
            </div>
            <div class="flex space-x-4 mt-6">
                <button id="cancel-edit"
                        class="flex-1 px-4 py-2 bg-gray-600 text-white rounded-button hover:bg-gray-500 transition-colors whitespace-nowrap">
                    취소
                </button>
                <button id="confirm-edit"
                        class="flex-1 px-4 py-2 bg-primary text-white rounded-button hover:bg-blue-600 transition-colors whitespace-nowrap">
                    저장
                </button>
            </div>
        </div>
    </div>
    <div id="delete-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-gray-800 rounded-xl p-6 max-w-md w-full mx-4">
            <h3 class="text-xl font-bold text-white mb-4">사용자 삭제</h3>
            <p class="text-gray-300 mb-6">
                선택한 사용자를 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다. </p>
            <div class="flex space-x-4">
                <button id="cancel-delete"
                        class="flex-1 px-4 py-2 bg-gray-600 text-white rounded-button hover:bg-gray-500 transition-colors whitespace-nowrap">
                    취소
                </button>
                <button id="confirm-delete"
                        class="flex-1 px-4 py-2 bg-red-600 text-white rounded-button hover:bg-red-500 transition-colors whitespace-nowrap">
                    삭제
                </button>
            </div>
        </div>
    </div>
    <div id="user-details-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div id="document-preview-modal"
             class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
            <div class="bg-gray-800 rounded-xl p-6 max-w-4xl w-full mx-4 max-h-[90vh] overflow-auto">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-bold text-white">사업자등록증</h3>
                    <button class="text-gray-400 hover:text-white close-preview">
                        <div class="w-6 h-6 flex items-center justify-center">
                            <i class="ri-close-line"></i>
                        </div>
                    </button>
                </div>
                <div class="bg-gray-700 rounded-lg p-4 justify-center">
                    <img id="business-registration-img" src="" alt="사업자등록증"
                         class="h-auto w-auto max-w-full max-h-[80vh] rounded-lg"/>
                    <a id="business-registration-pdf" href="" target="_blank">
                        PDF 열기
                    </a>
                </div>
                <div class="mt-6 flex justify-end gap-x-4">
                    <button class="px-4 py-2 bg-gray-600 text-white rounded-button hover:bg-gray-500 transition-colors whitespace-nowrap">
                        <a id="business-registration-download" class="text-primary" target="_blank"></a>
                    </button>
                    <button class="px-4 py-2 bg-gray-600 text-white rounded-button hover:bg-gray-500 transition-colors whitespace-nowrap close-preview">
                        닫기
                    </button>
                </div>
            </div>
        </div>
        <div class="bg-gray-800 rounded-xl p-6 max-w-2xl w-full mx-4">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-white">사용자 상세 정보</h3>
                <button id="close-details" class="text-gray-400 hover:text-white">
                    <div class="w-6 h-6 flex items-center justify-center">
                        <i class="ri-close-line"></i>
                    </div>
                </button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="space-y-4">
                    <div>
                        <h4 class="text-gray-400 text-sm">기본 정보</h4>
                        <div class="bg-gray-700 rounded-lg p-4 mt-2">
                            <div class="mb-3">
                                <p class="text-gray-400 text-sm">기업명</p>
                                <p class="text-white" id="detail-name">정수연</p>
                            </div>
                            <div>
                                <p class="text-gray-400 text-sm">회사 번호</p>
                                <p class="text-white" id="detail-tel">
                                    231213-123123 </p>
                            </div>
                            <div>
                                <p class="text-gray-400 text-sm">회사 주소</p>
                                <p class="text-white" id="detail-address">
                                    서울특별시 강남구 테헤란로 123 </p>
                            </div>
                            <div>
                                <p class="text-gray-400 text-sm">사업자등록번호</p>
                                <p class="text-white" id="detail-business-number">
                                    123-45-67890 </p>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h4 class="text-gray-400 text-sm">연락처 정보</h4>
                        <div class="bg-gray-700 rounded-lg p-4 mt-2">
                            <div class="mb-3">
                                <p class="text-gray-400 text-sm">대표 이름</p>
                                <p class="text-white" id="detail-ownerName">안용식</p>
                            </div>
                            <div class="mb-3">
                                <p class="text-gray-400 text-sm">이메일</p>
                                <p class="text-white" id="detail-email">
                                    suyeon.jung@email.com </p>
                            </div>
                            <div class="mb-3">
                                <p class="text-gray-400 text-sm">대표 전화번호</p>
                                <p class="text-white" id="detail-phone">02-1234-5678</p>
                            </div>
                            <div class="mb-3">
                                <p class="text-gray-400 text-sm">가입일</p>
                                <p class="text-white" id="detail-join-date">2024-12-15</p>
                            </div>
                            <div class="mb-3">
                                <p class="text-gray-400 text-sm">주소</p>
                                <p class="text-white" id="detail-owner-address">2024-12-15</p>
                            </div>
                            <!--                        <div class="mb-3">-->
                            <!--                            <p class="text-gray-400 text-sm">담당자 연락처</p>-->
                            <!--                            <p class="text-white" id="detail-contact-phone">-->
                            <!--                                010-1234-5678-->
                            <!--                            </p>-->
                            <!--                        </div>-->

                        </div>
                    </div>
                </div>
                <div class="space-y-4">
                    <div>
                        <h4 class="text-gray-400 text-sm">계정 정보</h4>
                        <div class="bg-gray-700 rounded-lg p-4 mt-2">
                            <div class="mb-3">
                                <p class="text-gray-400 text-sm">계정 상태</p>
                                <div class="flex items-center mt-1">
                                    <div class="w-2 h-2 rounded-full bg-green-500 mr-2"></div>
                                    <p class="text-white" id="detail-status">활성</p>
                                </div>
                            </div>
                            <div class="mb-3">
                                <p class="text-gray-400 text-sm">마지막 로그인</p>
                                <p class="text-white" id="detail-last-login">
                                    2025-01-09 08:45 </p>
                            </div>
                            <div>
                                <p class="text-gray-400 text-sm">로그인 방식</p>
                                <p class="text-white" id="detail-login-method">이메일</p>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h4 class="text-gray-400 text-sm">사업자 등록증</h4>
                        <div class="bg-gray-700 rounded-lg p-4 mt-2">
                            <div class="mb-3">
                                <p class="text-gray-400 text-sm">제출 상태</p>
                                <div class="flex items-center mt-1">
                                    <div class="w-2 h-2 rounded-full bg-green-500 mr-2"></div>
                                    <p class="text-white">확인 완료</p>
                                </div>
                            </div>
                            <!--                        <div class="mb-3">-->
                            <!--                            <p class="text-gray-400 text-sm">제출일</p>-->
                            <!--                            <p class="text-white">2024-12-15</p>-->
                            <!--                        </div>-->
                            <div>
                                <button class="mt-2 px-4 py-2 bg-gray-600 text-white rounded-button hover:bg-gray-500 transition-colors whitespace-nowrap flex items-center"
                                        id="view-business-registration">
                                    <div class="w-4 h-4 flex items-center justify-center mr-2">
                                        <i class="ri-file-text-line"></i>
                                    </div>
                                    사업자등록증 보기
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mt-6 flex justify-end">
                <button id="close-details-btn"
                        class="px-4 py-2 bg-gray-600 text-white rounded-button hover:bg-gray-500 transition-colors whitespace-nowrap">
                    닫기
                </button>
            </div>
        </div>
    </div>
</div>

<script id="checkbox-functionality" type="module">
    const selectAllCheckbox = document.getElementById("select-all");
    const userCheckboxes = document.querySelectorAll(".user-checkbox");
    selectAllCheckbox.addEventListener("change", function () {
        userCheckboxes.forEach((checkbox) => {
            checkbox.checked = this.checked;
        });
    });
    userCheckboxes.forEach((checkbox) => {
        checkbox.addEventListener("change", function () {
            const checkedCount = document.querySelectorAll(
                ".user-checkbox:checked",
            ).length;
            selectAllCheckbox.checked = checkedCount === userCheckboxes.length;
            selectAllCheckbox.indeterminate =
                checkedCount > 0 && checkedCount < userCheckboxes.length;
        });
    });
</script>
<script id="modal-functionality" type="module">
    const editModal = document.getElementById("edit-modal");
    const deleteModal = document.getElementById("delete-modal");
    const userDetailsModal = document.getElementById("user-details-modal");
    const editButtons = document.querySelectorAll(".edit-btn");
    const deleteButtons = document.querySelectorAll(".delete-btn");

    function showModal(modal) {
        modal.classList.remove("hidden");
        modal.classList.add("flex");
    }

    function hideModal(modal) {
        modal.classList.add("hidden");
        modal.classList.remove("flex");
    }

    editButtons.forEach((button) => {
        button.addEventListener("click", function () {
            const row = this.closest("tr");
            const name = row.cells[1].textContent;
            const email = row.cells[2].textContent;
            document.getElementById("edit-name").value = name;
            document.getElementById("edit-email").value = email;
            showModal(editModal);
        });
    });
    deleteButtons.forEach((button) => {
        button.addEventListener("click", function () {
            showModal(deleteModal);
        });
    });
    document
        .getElementById("cancel-edit")
        .addEventListener("click", () => hideModal(editModal));
    document
        .getElementById("cancel-delete")
        .addEventListener("click", () => hideModal(deleteModal));
    document
        .getElementById("confirm-edit")
        .addEventListener("click", function () {
            hideModal(editModal);
            alert("사용자 정보가 수정되었습니다.");
        });
    document
        .getElementById("confirm-delete")
        .addEventListener("click", function () {
            hideModal(deleteModal);
            alert("사용자가 삭제되었습니다.");
        });

    const viewDetailsButtons = document.querySelectorAll(".view-details-btn");
    viewDetailsButtons.forEach((button) => {
        button.addEventListener("click", async function () {
            const row = this.closest("tr");
            const name = row.cells[1].textContent;
            const email = row.cells[2].textContent;
            const joinDate = row.cells[3].textContent;
            const lastLogin = row.cells[4].textContent;
            const isActive = row.querySelector(".custom-switch input").checked;
            document.getElementById("detail-ownerName").textContent = name;
            document.getElementById("detail-email").textContent = email;
            document.getElementById("detail-join-date").textContent = joinDate;
            document.getElementById("detail-last-login").textContent = lastLogin;
            document.getElementById("detail-status").textContent = isActive
                ? "활성"
                : "비활성";
            document.getElementById(
                "detail-status",
            ).previousElementSibling.className = isActive
                ? "w-2 h-2 rounded-full bg-green-500 mr-2"
                : "w-2 h-2 rounded-full bg-red-500 mr-2";

            try {
                const response = await fetch(`/api/v1/admin/detail/${encodeURIComponent(email)}`);
                console.log("response" + response);
                const result = await response.json();
                console.log("result" + result);

                if (response.ok && result.isSuccess) {
                    const data = result.result;
                    document.getElementById("detail-name").textContent = data.agencyName;
                    document.getElementById("detail-tel").textContent = data.agencyTel;
                    document.getElementById("detail-address").textContent = data.agencyAddress;
                    document.getElementById("detail-business-number").textContent = "123-123-123";
                    document.getElementById("detail-phone").textContent = data.ownerTel;
                    document.getElementById("detail-owner-address").textContent = data.address;
                    // document.getElementById("business-registration-img").src = data.businessCertificationURl;

                    const imageEl = document.getElementById("business-registration-img");
                    const pdfEl = document.getElementById("business-registration-pdf");
                    const downloadLinkEl = document.getElementById("business-registration-download");

                    console.log("businessCertificationType:" + data.businessCertificationType);
                    console.log("url:" + data.businessCertificationURL);
                    console.log("downLoadurl:" + data.businessCertificationURL);

                    if (data.businessCertificationType === "IMG") {
                        imageEl.src = data.businessCertificationURL;
                        imageEl.classList.remove("hidden");
                        pdfEl.classList.add("hidden");
                    } else if (data.businessCertificationType === "FILE") {
                        pdfEl.href = data.businessCertificationURL;
                        pdfEl.classList.remove("hidden");
                        imageEl.classList.add("hidden");
                    }
                    downloadLinkEl.href = data.businessCertificationDownloadURL;
                    downloadLinkEl.download = ""; // 파일 다운로드
                    downloadLinkEl.textContent = "사업자등록증 다운로드";
                    showModal(userDetailsModal);
                } else {
                    alert("상세 정보를 불러오는 데 실패했습니다.");
                }
            } catch (err) {
                console.error(err);
                alert("서버 요청 중 오류가 발생했습니다.");
            }
        });
    });
    document
        .getElementById("close-details")
        .addEventListener("click", () => hideModal(userDetailsModal));
    document
        .getElementById("close-details-btn")
        .addEventListener("click", () => hideModal(userDetailsModal));
    const documentPreviewModal = document.getElementById(
        "document-preview-modal",
    );
    const viewBusinessRegistrationBtn = document.getElementById(
        "view-business-registration",
    );
    const closePreviewButtons = document.querySelectorAll(".close-preview");
    viewBusinessRegistrationBtn.addEventListener("click", () => {
        showModal(documentPreviewModal);
    });
    closePreviewButtons.forEach((button) => {
        button.addEventListener("click", () => hideModal(documentPreviewModal));
    });
    [
        editModal,
        deleteModal,
        userDetailsModal,
        documentPreviewModal,
    ].forEach((modal) => {
        modal.addEventListener("click", function (e) {
            if (e.target === modal) {
                hideModal(modal);
            }
        });
    });
</script>
<script id="status-toggle-functionality" type="module">
    const statusSwitches = document.querySelectorAll(".custom-switch input");
    statusSwitches.forEach((switchElement) => {
        switchElement.addEventListener("change", async function () {
            const row = this.closest("tr");
            const userName = row.cells[1].textContent;
            const userEmail = row.cells[2].textContent;
            const isActive = this.checked;
            const status = isActive ? "활성" : "비활성";
            const endpoint = isActive
                ? `/api/v1/admin/accept/${userEmail}`
                : `/api/v1/admin/pending/${userEmail}`;

            try {
                const response = await fetch(endpoint, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    }
                });

                if (response.ok) {
                    alert(`${userName}님의 상태가 ${status}로 변경되었습니다.`);
                } else {
                    alert(`상태 변경 실패: 서버 오류`);
                    this.checked = !this.checked; // 실패 시 롤백
                }
            } catch (error) {
                alert(`상태 변경 실패: 네트워크 오류`);
                this.checked = !this.checked;
                console.error(error);
            }
        });
    });
</script>
<script id="filter" type="module">
    const filterButton = document.getElementById("filter-btn");
    filterButton.addEventListener("click", function () {
        const keyword = document.getElementById("search-input").value.trim();
        const status = document.getElementById("status-filter").value;
        const date = document.getElementById("date-filter").value;

        const params = new URLSearchParams();
        if (keyword) params.append("keyword", keyword);
        if (status) params.append("status", status);
        if (date) params.append("date", date);
        params.append("page", 0); // 검색 시 1페이지부터 시작

        location.href = `/admin/user?${params.toString()}`;
    });
</script>
</body>
</html>
