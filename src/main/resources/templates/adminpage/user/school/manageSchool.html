<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>게시판 관리</title>
    <script src="https://cdn.tailwindcss.com/3.4.16"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
            href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap"
            rel="stylesheet"
    />
    <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css"
    />
<!--    편집툴-->
    <link href="https://cdn.jsdelivr.net/npm/suneditor@latest/dist/css/suneditor.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/suneditor@latest/dist/suneditor.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/suneditor@latest/src/lang/ko.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: "#3498DB",
                        secondary: "#2C3E50",
                    },
                    borderRadius: {
                        none: "0px",
                        sm: "4px",
                        DEFAULT: "8px",
                        md: "12px",
                        lg: "16px",
                        xl: "20px",
                        "2xl": "24px",
                        "3xl": "32px",
                        full: "9999px",
                        button: "8px",
                    },
                },
            },
        };
    </script>
    <style>
        :where([class^="ri-"])::before {
            content: "\f3c2";
        }
        .admin-card {
            background: linear-gradient(145deg, #2C2C3A, #232331);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        .table-header {
            background: linear-gradient(135deg, #343446, #2A2A3C);
        }
        .table-row:hover {
            background: rgba(52, 152, 219, 0.1);
        }
        .status-badge {
            backdrop-filter: blur(10px);
        }
        .tree-node {
            transition: all 0.3s ease;
        }
        .tree-node.expanded > .tree-children {
            max-height: 1000px;
            opacity: 1;
        }
        .tree-children {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        .editor-toolbar {
            background: linear-gradient(135deg, #343446, #2A2A3C);
            border-bottom: 1px solid #374151;
        }
        .editor-content {
            min-height: 400px;
            background: #1F2937;
            color: #F9FAFB;
        }
        .board-type-tag {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            font-weight: 500;
        }
    </style>
</head>
<body
        class="bg-gradient-to-br from-gray-900 via-slate-800 to-gray-900 min-h-screen text-gray-100"
>
<div class="flex">

<!--    leftSide-->

    <aside th:replace="~{adminpage/common/leftSide :: leftSide}"></aside>

    <main class="flex-1 p-8">
        <div id="board-list-view">
            <header class="mb-8">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-3xl font-bold text-white">게시판 관리</h1>
                        <p class="text-gray-400 mt-2">
                            학교별 게시판을 관리하고 수정하세요
                        </p>
                    </div>
                    <div class="flex items-center space-x-4">
                        <select
                                class="bg-gray-700 text-white px-4 py-2 rounded-lg border-none pr-8"
                        >
                            <option>전체 학교</option>
                            <option th:each="school : ${schoolDto}"
                                    th:value="${school.schoolDto.englishName}"
                                    th:text="${school.schoolDto.englishName}">
                                학교 이름
                            </option>
                        </select>
                        <button
                                onclick="openAddBoardModal()"
                                class="px-4 py-2 bg-primary text-white rounded-button hover:bg-blue-600 transition-colors whitespace-nowrap"
                        >
                            <div
                                    class="w-4 h-4 inline-flex items-center justify-center mr-2"
                            >
                                <i class="ri-add-line"></i>
                            </div>
                            새 게시판 추가
                        </button>
                    </div>

                    <div
                            id="addCategoryModal"
                            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50"
                    >
                        <div class="bg-gray-800 rounded-xl p-6 w-[480px] shadow-2xl">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-xl font-bold text-white">
                                    새 카테고리 추가
                                </h3>
                                <button
                                        onclick="closeAddCategoryModal()"
                                        class="text-gray-400 hover:text-white transition-colors"
                                >
                                    <div class="w-6 h-6 flex items-center justify-center">
                                        <i class="ri-close-line"></i>
                                    </div>
                                </button>
                            </div>
                            <div class="space-y-4">
                                <div>
                                    <label for="boardTitle" class="block text-sm font-medium text-gray-300 mb-2">카테고리 이름</label>
                                    <input
                                            id="boardTitle"
                                            type="text"
                                            class="w-full bg-gray-700 text-white px-4 py-3 rounded-lg border-none"
                                            placeholder="카테고리 이름을 입력하세요"
                                    />
                                </div>
                                <div>
                                    <label for="boardDesc" class="block text-sm font-medium text-gray-300 mb-2">카테고리 설명</label>
                                    <input
                                            id="boardDesc"
                                            type="text"
                                            class="w-full bg-gray-700 text-white px-4 py-3 rounded-lg border-none"
                                            placeholder="카테고리 이름을 입력하세요"
                                    />
                                </div>
                                <div>
                                    <label
                                            class="block text-sm font-medium text-gray-300 mb-2"
                                    >게시판 유형</label
                                    >
                                    <div class="grid grid-cols-2 gap-4">
                                        <label
                                                class="relative flex items-center justify-center p-4 bg-gray-700 rounded-lg cursor-pointer group hover:bg-gray-600 transition-colors"
                                        >
                                            <input
                                                    type="radio"
                                                    name="boardType"
                                                    value="intro"
                                                    class="sr-only"
                                                    checked
                                            />
                                            <div class="flex flex-col items-center">
                                                <div
                                                        class="w-8 h-8 flex items-center justify-center mb-2 text-primary"
                                                >
                                                    <i class="ri-file-text-line"></i>
                                                </div>
                                                <span class="text-white font-medium">소개형</span>
                                                <span class="text-xs text-gray-400 mt-1"
                                                >단일 페이지 형태</span
                                                >
                                            </div>
                                            <div
                                                    class="absolute inset-0 border-2 border-primary rounded-lg opacity-0 group-hover:opacity-100 pointer-events-none"
                                            ></div>
                                        </label>
                                        <label
                                                class="relative flex items-center justify-center p-4 bg-gray-700 rounded-lg cursor-pointer group hover:bg-gray-600 transition-colors"
                                        >
                                            <input
                                                    type="radio"
                                                    name="boardType"
                                                    value="board"
                                                    class="sr-only"
                                            />
                                            <div class="flex flex-col items-center">
                                                <div
                                                        class="w-8 h-8 flex items-center justify-center mb-2 text-primary"
                                                >
                                                    <i class="ri-list-check"></i>
                                                </div>
                                                <span class="text-white font-medium">게시글형</span>
                                                <span class="text-xs text-gray-400 mt-1"
                                                >다중 게시글 형태</span
                                                >
                                            </div>
                                            <div
                                                    class="absolute inset-0 border-2 border-primary rounded-lg opacity-0 group-hover:opacity-100 pointer-events-none"
                                            ></div>
                                        </label>
                                        <label
                                                class="relative flex items-center justify-center p-4 bg-gray-700 rounded-lg cursor-pointer group hover:bg-gray-600 transition-colors"
                                        >
                                            <input
                                                    type="radio"
                                                    name="boardType"
                                                    value="files"
                                                    class="sr-only"
                                                    checked
                                            />
                                            <div class="flex flex-col items-center">
                                                <div
                                                        class="w-8 h-8 flex items-center justify-center mb-2 text-primary"
                                                >
                                                    <i class="ri-file-text-line"></i>
                                                </div>
                                                <span class="text-white font-medium">파일 목록형</span>
                                                <span class="text-xs text-gray-400 mt-1"
                                                >파일 목록 형태</span
                                                >
                                            </div>
                                            <div
                                                    class="absolute inset-0 border-2 border-primary rounded-lg opacity-0 group-hover:opacity-100 pointer-events-none"
                                            ></div>
                                        </label>
                                        <label
                                                class="relative flex items-center justify-center p-4 bg-gray-700 rounded-lg cursor-pointer group hover:bg-gray-600 transition-colors"
                                        >
                                            <input
                                                    type="radio"
                                                    name="boardType"
                                                    value="schedule"
                                                    class="sr-only"
                                            />
                                            <div class="flex flex-col items-center">
                                                <div
                                                        class="w-8 h-8 flex items-center justify-center mb-2 text-primary"
                                                >
                                                    <i class="ri-calendar-check-line"></i>
                                                </div>
                                                <span class="text-white font-medium">스캐줄 게시판</span>
                                                <span class="text-xs text-gray-400 mt-1"
                                                >일정 추가 형태</span
                                                >
                                            </div>
                                            <div
                                                    class="absolute inset-0 border-2 border-primary rounded-lg opacity-0 group-hover:opacity-100 pointer-events-none"
                                            ></div>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="flex justify-end space-x-3 mt-6">
                                <button
                                        onclick="closeAddCategoryModal()"
                                        class="px-4 py-2 bg-gray-700 text-white rounded-button hover:bg-gray-600 transition-colors whitespace-nowrap"
                                >
                                    취소
                                </button>
                                <button
                                        onclick="submitAddCategory()"
                                        class="px-4 py-2 bg-primary text-white rounded-button hover:bg-blue-600 transition-colors whitespace-nowrap"
                                >
                                    추가하기
                                </button>
                            </div>
                        </div>
                    </div>

                    <div
                            id="addBoardModal"
                            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50"
                    >
                        <div class="bg-gray-800 rounded-xl p-6 w-[480px] shadow-2xl">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-xl font-bold text-white">새 게시판 추가</h3>
                                <button
                                        onclick="closeAddBoardModal()"
                                        class="text-gray-400 hover:text-white transition-colors"
                                >
                                    <div class="w-6 h-6 flex items-center justify-center">
                                        <i class="ri-close-line"></i>
                                    </div>
                                </button>
                            </div>
                            <div class="space-y-4">
                                <div>
                                    <label
                                            class="block text-sm font-medium text-gray-300 mb-2"
                                    >학교 이름(한국어)</label
                                    >
                                    <input
                                            type="text"
                                            class="w-full bg-gray-700 text-white px-4 py-3 rounded-lg border-none"
                                            placeholder="학교 이름을 입력하세요"
                                    />
                                </div>
                                <div>
                                    <label
                                            class="block text-sm font-medium text-gray-300 mb-2"
                                    >학교 이름(영어)</label
                                    >
                                    <input
                                            type="text"
                                            class="w-full bg-gray-700 text-white px-4 py-3 rounded-lg border-none"
                                            placeholder="학교 이름을 입력하세요"
                                    />
                                </div>
                                <div>
                                    <label
                                            class="block text-sm font-medium text-gray-300 mb-2"
                                    >학교 로고 URL</label
                                    >
                                    <input
                                            type="url"
                                            class="w-full bg-gray-700 text-white px-4 py-3 rounded-lg border-none"
                                            placeholder="로고 이미지 URL을 입력하세요"
                                    />
                                </div>
                            </div>
                            <div class="flex justify-end space-x-3 mt-6">
                                <button
                                        onclick="closeAddBoardModal()"
                                        class="px-4 py-2 bg-gray-700 text-white rounded-button hover:bg-gray-600 transition-colors whitespace-nowrap"
                                >
                                    취소
                                </button>
                                <button
                                        onclick="saveNewBoard()"
                                        class="px-4 py-2 bg-primary text-white rounded-button hover:bg-blue-600 transition-colors whitespace-nowrap"
                                >
                                    추가하기
                                </button>
                            </div>
                        </div>
                    </div>
                    <script id="modal-functions">
                        document.addEventListener("DOMContentLoaded", function () {
                            window.openAddBoardModal = function () {
                                document.getElementById("addBoardModal").classList.remove("hidden");
                            };
                            window.closeAddBoardModal = function () {
                                document.getElementById("addBoardModal").classList.add("hidden");
                            };
                            window.openCategoryModal = function () {
                                document.getElementById("categoryModal").classList.remove("hidden");
                            };
                            window.closeCategoryModal = function () {
                                document.getElementById("categoryModal").classList.add("hidden");
                            };
                            window.openAddCategoryModal = function (buttonElement) {
                                const modal = document.getElementById("addCategoryModal");
                                const schoolId = buttonElement.dataset.schoolId;
                                modal.dataset.schoolId = schoolId;
                                modal.classList.remove("hidden");
                            };

                            window.closeAddCategoryModal = function () {
                                const modal = document.getElementById("addCategoryModal");
                                modal.classList.add("hidden");
                                modal.dataset.schoolId = "";
                            };

                            window.deleteCategory = function (categoryName) {
                                if (confirm(`"${categoryName}" 카테고리를 삭제하시겠습니까?`)) {
                                    const notification = document.createElement("div");
                                    notification.className =
                                        "fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50";
                                    notification.textContent = "카테고리가 삭제되었습니다";
                                    document.body.appendChild(notification);
                                    setTimeout(() => notification.remove(), 3000);
                                }
                            };
                            window.saveNewBoard = async function () {
                                const koreanNameInput = document.querySelectorAll(
                                    '#addBoardModal input[type="text"]'
                                )[0]; // 한국어 이름
                                const englishNameInput = document.querySelectorAll(
                                    '#addBoardModal input[type="text"]'
                                )[1]; // 영어 이름
                                const logoUrlInput = document.querySelector('#addBoardModal input[type="url"]');

                                const schoolKoreanName = koreanNameInput.value.trim();
                                const schoolEnglishName = englishNameInput.value.trim();
                                const imgUrl = logoUrlInput.value.trim();

                                if (!schoolKoreanName || !schoolEnglishName || !imgUrl) {
                                    const notification = document.createElement("div");
                                    notification.className =
                                        "fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50";
                                    notification.textContent = "모든 항목을 입력해주세요";
                                    document.body.appendChild(notification);
                                    setTimeout(() => notification.remove(), 3000);
                                    return;
                                }

                                const payload = {
                                    schoolKoreanName: schoolKoreanName,
                                    schoolEnglishName: schoolEnglishName,
                                    imgUrl: imgUrl,
                                };

                                try {
                                    const response = await fetch("/api/v1/admin/school/save", {
                                        method: "POST",
                                        headers: {
                                            "Content-Type": "application/json",
                                        },
                                        body: JSON.stringify(payload),
                                    });

                                    const result = await response.json();

                                    if (result.isSuccess) {
                                        const notification = document.createElement("div");
                                        notification.className =
                                            "fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50";
                                        notification.textContent = "새 게시판이 추가되었습니다";
                                        document.body.appendChild(notification);
                                        setTimeout(() => notification.remove(), 3000);
                                        closeAddBoardModal();
                                        location.reload(); // 새로고침해서 반영
                                    } else {
                                        throw new Error(result.message || "추가 실패");
                                    }
                                } catch (error) {
                                    const notification = document.createElement("div");
                                    notification.className =
                                        "fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50";
                                    notification.textContent = "오류 발생: " + error.message;
                                    document.body.appendChild(notification);
                                    setTimeout(() => notification.remove(), 3000);
                                }
                            };
                        });
                    </script>
                </div>
            </header>
            <div class="admin-card rounded-xl p-6">
                <div class="space-y-4">
                    <div th:each="schoolPage : ${schoolDto}" class="tree-node">
                        <div
                                class="flex items-center justify-between p-4 bg-gray-700 rounded-lg cursor-pointer"
                                th:attr="data-english-name=${schoolPage.schoolDto.englishName}"
                                onclick="toggleSchool(this.dataset.englishName)"
                        >
                            <div class="flex items-center">
                                <div class="w-5 h-5 flex items-center justify-center mr-3 text-primary">
                                    <i class="ri-arrow-right-s-line tree-arrow"
                                       th:id="${schoolPage.schoolDto.englishName + '-arrow'}"></i>
                                </div>
                                <h3 class="text-lg font-semibold text-white"
                                    th:text="${schoolPage.schoolDto.koreanName}">학교 이름</h3>
                                <span class="ml-3 text-sm text-gray-400"
                                      th:text="'(' + ${#lists.size(schoolPage.boardDtos)} + '개 게시판)'">
                                    (0개 게시판)
                                </span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button
                                        class="px-3 py-1 bg-primary text-white text-sm rounded-button hover:bg-blue-600 transition-colors whitespace-nowrap"
                                        th:attr="data-school-id=${schoolPage.schoolDto.schoolId}, data-english-name=${schoolPage.schoolDto.englishName}"
                                        onclick="openAddCategoryModal(this)"
                                >
                                    <div class="w-4 h-4 inline-flex items-center justify-center mr-1">
                                        <i class="ri-add-line"></i>
                                    </div>
                                    새 카테고리 추가
                                </button>
                            </div>
                        </div>

                        <div class="tree-children ml-8" th:id="${schoolPage.schoolDto.englishName + '-children'}">
                            <div class="space-y-3 mt-4">
                                <div class="bg-gray-800 rounded-lg p-4">
                                    <div class="space-y-2">
                                        <div class="flex items-center justify-between p-3 bg-gray-700 rounded-lg" th:each="board : ${schoolPage.boardDtos}"
                                             th:attr="data-board-id=${board.id}"
                                        >
                                            <div class="flex items-center">
                                                <div class="w-4 h-4 flex items-center justify-center mr-3">
                                                    <i th:classappend="${board.boardType == 'INTRO'} ? 'ri-file-text-line' : 'ri-file-list-line'"
                                                       class="text-gray-400"></i>
                                                </div>
                                                <span class="text-white" th:text="${board.boardTitle}">게시판 제목</span>
                                                <span class="board-type-tag ml-3"
                                                      th:with="
                                                        typeName=${board.boardType != null} ? ${board.boardType} : 'UNKNOWN',
                                                        typeClass=${typeName == 'INTRO'}  ? ' bg-blue-500 bg-opacity-20 text-blue-400' :
                                                                    (${typeName == 'NOTICE'} ? ' bg-green-500 bg-opacity-20 text-green-400' :
                                                                    (${typeName == 'FILES'}  ? ' bg-yellow-500 bg-opacity-20 text-yellow-400' :
                                                                    (${typeName == 'SCHEDULE'} ? ' bg-purple-500 bg-opacity-20 text-purple-400' :
                                                                                                 ' bg-gray-500 bg-opacity-20 text-gray-400'))),
                                                        typeText=${typeName == 'INTRO'}  ? '소개페이지' :
                                                                   (${typeName == 'NOTICE'} ? '게시판형' :
                                                                   (${typeName == 'FILES'}  ? '파일형' :
                                                                   (${typeName == 'SCHEDULE'} ? '스케줄형' : '알 수 없음')))"
                                                      th:classappend="${typeClass}"
                                                      th:text="${typeText}">
                                                  게시판 유형
                                                </span>
                                            </div>
                                            <div class="flex space-x-2">
                                                <button
                                                        class="px-3 py-1 bg-primary text-white text-sm rounded-button hover:bg-blue-600 transition-colors whitespace-nowrap"
                                                        th:if="${board.boardType == 'INTRO'}"
                                                        th:attr="data-board-title=${board.boardTitle}"
                                                        onclick="editIntroBoard(this.dataset.boardTitle)"
                                                >
                                                    수정
                                                </button>

                                                <button
                                                        class="px-3 py-1 bg-primary text-white text-sm rounded-button hover:bg-blue-600 transition-colors whitespace-nowrap"
                                                        th:if="${board.boardType == 'NOTICE'}"
                                                        th:attr="data-board-title=${board.boardTitle}, data-board-id=${board.id}, data-board-type=${board.boardType}"
                                                        onclick="editBoardList(this.dataset.boardTitle, this.dataset.boardId, this.dataset.boardType)"
                                                >
                                                    수정
                                                </button>

                                                <button
                                                        class="px-3 py-1 bg-primary text-white text-sm rounded-button hover:bg-blue-600 transition-colors whitespace-nowrap"
                                                        th:if="${board.boardType == 'FILES'}"
                                                        th:attr="data-board-title=${board.boardTitle}, data-board-id=${board.id}, data-board-type=${board.boardType}"
                                                        onclick="editBoardList(this.dataset.boardTitle, this.dataset.boardId, this.dataset.boardType)"
                                                >
                                                    수정
                                                </button>
                                                <button
                                                        class="px-3 py-1 bg-primary text-white text-sm rounded-button hover:bg-blue-600 transition-colors whitespace-nowrap"
                                                        th:if="${board.boardType == 'SCHEDULE'}"
                                                        th:attr="data-board-title=${board.boardTitle}, data-board-id=${board.id}, data-board-type=${board.boardType}"
                                                        onclick="editScheduleList(this.dataset.boardTitle, this.dataset.boardId, this.dataset.boardType)"
                                                >
                                                    수정
                                                </button>
                                                <button
                                                        class="px-3 py-1 bg-red-600 text-white text-sm rounded-button hover:bg-red-700 transition-colors whitespace-nowrap"
                                                        th:attr="data-board-title=${board.boardTitle},data-board-id=${board.id()}"
                                                        onclick="deleteBoard(this.dataset.boardTitle,this.dataset.boardId)"
                                                >
                                                    삭제
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="intro-board-editor" class="hidden">
            <header class="mb-8">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <button
                                onclick="showBoardList()"
                                class="mr-4 p-2 text-gray-400 hover:text-white transition-colors"
                        >
                            <div class="w-5 h-5 flex items-center justify-center">
                                <i class="ri-arrow-left-line"></i>
                            </div>
                        </button>
                        <div>
                            <h1
                                    class="text-3xl font-bold text-white"
                                    id="intro-board-title"
                            >
                                소개페이지 수정
                            </h1>
                            <p class="text-gray-400 mt-2">
                                페이지 내용을 수정하고 저장하세요
                            </p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button
                                onclick="showBoardList()"
                                class="px-4 py-2 bg-gray-600 text-white rounded-button hover:bg-gray-500 transition-colors whitespace-nowrap"
                        >
                            취소
                        </button>
                        <button
                                onclick="saveIntroBoard()"
                                class="px-4 py-2 bg-primary text-white rounded-button hover:bg-blue-600 transition-colors whitespace-nowrap"
                        >
                            저장하기
                        </button>
                    </div>
                </div>
            </header>
            <div id="editor-wrapper" class="admin-card rounded-xl overflow-hidden h-auto">
                <textarea id="school-intro-editor" name="content"></textarea>
            </div>
        </div>
        <div id="board-list-editor" class="hidden">
<!--            게시글 목록 보여주기-->
            <header class="mb-8">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <button
                                onclick="showBoardList()"
                                class="mr-4 p-2 text-gray-400 hover:text-white transition-colors"
                        >
                            <div class="w-5 h-5 flex items-center justify-center">
                                <i class="ri-arrow-left-line"></i>
                            </div>
                        </button>
                        <div>
                            <h1
                                    class="text-3xl font-bold text-white"
                                    id="board-list-title"

                            >
                                게시판 관리
                            </h1>
                            <p class="text-gray-400 mt-2">게시글을 관리하고 수정하세요</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button
                                onclick="createNewPost()"
                                class="px-4 py-2 bg-primary text-white rounded-button hover:bg-blue-600 transition-colors whitespace-nowrap"
                        >
                            <div
                                    class="w-4 h-4 inline-flex items-center justify-center mr-2"
                            >
                                <i class="ri-add-line"></i>
                            </div>
                            새 게시글 작성
                        </button>
                    </div>
                </div>
            </header>
            <div class="admin-card rounded-xl p-6">
                <div class="mb-6">
                    <div class="flex items-center justify-between">
                        <h2 class="text-xl font-bold text-white">게시글 목록</h2>
                        <div class="flex items-center space-x-4">
                            <select
                                    class="bg-gray-700 text-white px-3 py-2 rounded-lg text-sm border-none pr-8"
                            >
                                <option>전체</option>
                                <option>공지</option>
                                <option>일반</option>
                            </select>
                            <div class="relative">
                                <input
                                        type="text"
                                        placeholder="제목 검색..."
                                        class="bg-gray-700 text-white px-4 py-2 pr-10 rounded-lg text-sm border-none"
                                />
                                <div
                                        class="absolute right-3 top-1/2 transform -translate-y-1/2 w-4 h-4 flex items-center justify-center"
                                >
                                    <i class="ri-search-line text-gray-400"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                        <tr class="table-header text-left">
                            <th class="p-3 text-sm font-medium text-gray-300">제목</th>
                            <th class="p-3 text-sm font-medium text-gray-300">
                                작성자
                            </th>
                            <th class="p-3 text-sm font-medium text-gray-300">
                                작성일
                            </th>
                            <th class="p-3 text-sm font-medium text-gray-300">
                                조회수
                            </th>
                            <th class="p-3 text-sm font-medium text-gray-300">상태</th>
                            <th class="p-3 text-sm font-medium text-gray-300">관리</th>
                        </tr>
                        </thead>
                        <tbody id="post-table-body">

                        </tbody>
                    </table>
                </div>
                <div class="flex items-center justify-center mt-6">
                    <div id="pagination" class="flex items-center space-x-2">

                    </div>
                </div>
            </div>
        </div>
        <!-- 스케줄 리스트 전용 뷰 -->
        <div id="schedule-list-editor" class="hidden">
            <!-- 헤더 -->
            <header class="mb-8">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <button
                                onclick="showBoardList()"
                                class="mr-4 p-2 text-gray-400 hover:text-white transition-colors"
                        >
                            <div class="w-5 h-5 flex items-center justify-center">
                                <i class="ri-arrow-left-line"></i>
                            </div>
                        </button>
                        <div>
                            <h1 class="text-3xl font-bold text-white" id="schedule-list-title">
                                일정 관리
                            </h1>
                            <p class="text-gray-400 mt-2">일정을 관리하고 수정하세요</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button
                                onclick="openAddScheduleModal()"
                                class="px-4 py-2 bg-primary text-white rounded-button hover:bg-blue-600 transition-colors whitespace-nowrap"
                        >
                            <div class="w-4 h-4 inline-flex items-center justify-center mr-2">
                                <i class="ri-add-line"></i>
                            </div>
                            새 일정 추가
                        </button>
                    </div>
                </div>
            </header>

            <div class="admin-card rounded-xl p-6">
                <!-- 필터 -->
                <div class="mb-6">
                    <div class="flex items-center justify-between flex-col sm:flex-row gap-4">
                        <h2 class="text-xl font-bold text-white">일정 목록</h2>

                        <div class="flex items-center gap-3 flex-wrap">
                            <!-- 타입 필터 -->
                            <select
                                    id="schedule-type-filter"
                                    class="bg-gray-700 text-white px-3 py-2 rounded-lg text-sm border-none pr-8"
                            >
                                <option value="">전체 타입</option>
                                <option value="ACADEMIC">ACADEMIC</option>
                                <option value="ADMISSION">ADMISSION</option>
                                <option value="SCHOLARSHIP">SCHOLARSHIP</option>
                                <option value="DORMITORY">DORMITORY</option>
                                <option value="INTERNATIONAL">INTERNATIONAL</option>
                            </select>

                            <!-- 날짜 범위 -->
                            <div class="flex items-center gap-2">
                                <input
                                        id="schedule-date-from"
                                        type="date"
                                        class="bg-gray-700 text-white px-3 py-2 rounded-lg text-sm border-none"
                                />
                                <span class="text-gray-400 text-sm">~</span>
                                <input
                                        id="schedule-date-to"
                                        type="date"
                                        class="bg-gray-700 text-white px-3 py-2 rounded-lg text-sm border-none"
                                />
                            </div>

                            <!-- 키워드 검색 -->
                            <div class="relative">
                                <input
                                        id="schedule-search"
                                        type="text"
                                        placeholder="제목 검색..."
                                        class="bg-gray-700 text-white px-4 py-2 pr-10 rounded-lg text-sm border-none"
                                />
                                <div
                                        class="absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 flex items-center justify-center"
                                >
                                    <i class="ri-search-line text-gray-400"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                        <tr class="table-header text-left">
                            <th class="p-3 text-sm font-medium text-gray-300">제목</th>
                            <th class="p-3 text-sm font-medium text-gray-300">시작일</th>
                            <th class="p-3 text-sm font-medium text-gray-300">종료일</th>
                            <th class="p-3 text-sm font-medium text-gray-300">타입</th>
                            <th class="p-3 text-sm font-medium text-gray-300">상태</th>
                            <th class="p-3 text-sm font-medium text-gray-300">관리</th>
                        </tr>
                        </thead>
                        <tbody id="schedule-table-body">
                        </tbody>
                    </table>
                </div>

                <!-- 페이지네이션 -->
                <div class="flex items-center justify-center mt-6">
                    <div id="schedule-pagination" class="flex items-center space-x-2"></div>
                </div>
            </div>
        </div>
        <script id="schedule-modal-functions">
            // 신규 작성 열기
            window.openAddScheduleModal = function () {
                const modal = document.getElementById("addScheduleModal");
                // 모드 초기화
                modal.dataset.scheduleId = "";
                document.getElementById("scheduleTitle").value = "";
                document.getElementById("scheduleStartDate").value = "";
                document.getElementById("scheduleEndDate").value = "";
                // 기본 타입 체크
                document.querySelector('input[name="scheduleType"][value="ACADEMIC"]').checked = true;

                // 타이틀도 바꾸고 열기
                modal.querySelector("h3").textContent = "새 일정 추가";
                modal.classList.remove("hidden");
                modal.setAttribute("aria-hidden", "false");
            };

            // 수정 모드 열기 (스케줄 데이터 넣어줌)
            window.openEditScheduleModal = async function (scheduleId) {
                const modal = document.getElementById("addScheduleModal");
                const res = await fetch(`/api/v1/admin/school/schedule?postId=${scheduleId}`);
                const json = await res.json();
                if (!json.isSuccess) throw new Error(json.message || "조회 실패");

                const s = json.result;

                modal.dataset.scheduleId = String(s.id);
                document.getElementById("scheduleTitle").value = s.title ?? "";
                document.getElementById("scheduleStartDate").value = s.startDate ?? "";
                document.getElementById("scheduleEndDate").value = s.endDate ?? "";
                // 타입 라디오
                const typeInput = document.querySelector(`input[name="scheduleType"][value="${s.type}"]`);
                if (typeInput) typeInput.checked = true;

                modal.querySelector("h3").textContent = "일정 수정";
                modal.classList.remove("hidden");
                modal.setAttribute("aria-hidden", "false");
            };

            // 닫기(모든 경로에서 id 제거)
            window.closeAddScheduleModal = function () {
                const modal = document.getElementById("addScheduleModal");
                modal.classList.add("hidden");
                modal.setAttribute("aria-hidden", "true");
                // 다음 열림에 영향 없게 비움
                modal.dataset.scheduleId = "";
            };

            // 초기 바인딩(위임 방식)
            document.addEventListener("DOMContentLoaded", function () {
                const modal = document.getElementById("addScheduleModal");
                if (!modal) {
                    console.warn("[ScheduleModal] #addScheduleModal not in DOM at load (will still work if added later).");
                }

                // id="openAddScheduleBtn" 가 있다면 자동 바인딩(선택 사항)
                const openBtn = document.getElementById("openAddScheduleBtn");
                if (openBtn) openBtn.addEventListener("click", openAddScheduleModal);

                // 모달 내부 닫기/취소 버튼 위임 바인딩
                document.addEventListener("click", (e) => {
                    // 오버레이 클릭으로 닫기
                    const overlay = document.getElementById("addScheduleModal");
                    if (overlay && e.target === overlay) {
                        closeAddScheduleModal();
                        return;
                    }

                    // 닫기 버튼들
                    if (e.target.closest("#closeAddScheduleModalBtn")) {
                        closeAddScheduleModal();
                        return;
                    }
                    if (e.target.closest("#scheduleCancelBtn")) {
                        closeAddScheduleModal();
                        return;
                    }
                });

                // ESC 로 닫기
                document.addEventListener("keydown", (e) => {
                    const m = document.getElementById("addScheduleModal");
                    if (e.key === "Escape" && m && !m.classList.contains("hidden")) {
                        closeAddScheduleModal();
                    }
                });
            });
        </script>
        <script id="scheduleFetch">
            async function fetchScheduleList(boardId, page = 0) {
                const root = document.getElementById("schedule-list-editor");
                const typeEl = root.querySelector("#schedule-type-filter");
                const fromEl = root.querySelector("#schedule-date-from");
                const toEl   = root.querySelector("#schedule-date-to");
                const kwEl   = root.querySelector("#schedule-search");

                const type = (typeEl?.value || "").trim();           // ACADEMIC|...|""(전체)
                const from = (fromEl?.value || "").trim();           // YYYY-MM-DD
                const to   = (toEl?.value || "").trim();             // YYYY-MM-DD
                const keyword = (kwEl?.value || "").trim();

                const params = new URLSearchParams();
                params.append("boardId", boardId);
                params.append("page", String(page));
                // params.append("size", "10");
                if (keyword) params.append("title", keyword);
                if (type)    params.append("type", type);
                if (from)    params.append("startDate", from);
                if (to)      params.append("endDate", to);

                try {
                    const res = await fetch(`/api/v1/admin/school/schedules?${params.toString()}`);
                    const json = await res.json();

                    if (json.isSuccess) {
                        const pageData = json.result;          // { content, totalPages, number, ... }
                        renderScheduleTable(pageData.content); // tbody 렌더
                        renderSchedulePagination(pageData, boardId);
                    } else {
                        alert("일정 목록 불러오기 실패: " + (json.message || ""));
                    }
                } catch (e) {
                    console.error(e);
                    alert("서버 오류 발생");
                }
            }

            // ✅ 테이블 렌더 (#schedule-table-body)
            function renderScheduleTable(schedules = []) {
                const tbody = document.getElementById("schedule-table-body");
                if (!tbody) return;
                tbody.innerHTML = "";

                const today = new Date();
                const pad2 = (n) => String(n).padStart(2, "0");
                const fmt = (d) => {
                    if (!d) return "-";
                    // 서버가 'YYYY-MM-DD'라면 그대로 출력
                    if (/^\d{4}-\d{2}-\d{2}$/.test(d)) return d;
                    // 혹시 ISO면 날짜만
                    const dt = new Date(d);
                    return isNaN(dt) ? "-" : `${dt.getFullYear()}-${pad2(dt.getMonth()+1)}-${pad2(dt.getDate())}`;
                };
                const statusBadge = (startDate, endDate) => {
                    // 진행 상태 계산 (클라이언트 표시용)
                    const s = startDate ? new Date(startDate) : null;
                    const e = endDate ? new Date(endDate) : null;

                    let label = "진행중", cls = "bg-green-500 text-green-400";
                    if (s && s > today) { label = "예정"; cls = "bg-yellow-500 text-yellow-400"; }
                    if (e && e < today) { label = "종료"; cls = "bg-gray-500 text-gray-400"; }

                    return `<span class="status-badge px-2 py-1 ${cls} bg-opacity-20 text-xs rounded-full">${label}</span>`;
                };

                schedules.forEach((sch) => {
                    const tr = document.createElement("tr");
                    tr.className = "table-row border-b border-gray-700";
                    tr.innerHTML = `
        <td class="p-3 text-white">${sch.title || "-"}</td>
        <td class="p-3 text-gray-300">${fmt(sch.startDate)}</td>
        <td class="p-3 text-gray-300">${fmt(sch.endDate)}</td>
        <td class="p-3">
          <span class="status-badge px-2 py-1 bg-blue-500 bg-opacity-20 text-blue-400 text-xs rounded-full">
            ${sch.type || "-"}
          </span>
        </td>
        <td class="p-3">
          ${statusBadge(sch.startDate, sch.endDate)}
        </td>
        <td class="p-3">
          <div class="flex space-x-2">
            <button
              class="px-3 py-1 bg-primary text-white text-sm rounded-button hover:bg-blue-600 transition-colors whitespace-nowrap"
              onclick="openEditScheduleModal(${sch.id})"
            >
              수정
            </button>
            <button
              class="px-3 py-1 bg-red-600 text-white text-sm rounded-button hover:bg-red-700 transition-colors whitespace-nowrap"
              onclick="deleteSchedule(${sch.id})"
            >
              삭제
            </button>
          </div>
        </td>
      `;
                    tbody.appendChild(tr);
                });
            }

            // ✅ 페이지네이션 렌더 (#schedule-pagination)
            function renderSchedulePagination(pageData, boardId) {
                const container = document.getElementById("schedule-pagination");
                if (!container) return;
                container.innerHTML = "";

                const { totalPages, number } = pageData;

                const makeBtn = (html, disabled, onClick) => {
                    const b = document.createElement("button");
                    b.innerHTML = html;
                    b.className = `px-3 py-2 ${disabled ? "text-gray-600 cursor-not-allowed" : "text-gray-400 hover:text-white"} transition-colors`;
                    b.disabled = !!disabled;
                    if (!disabled) b.onclick = onClick;
                    return b;
                };

                // Prev
                container.appendChild(
                    makeBtn(`<i class="ri-arrow-left-line"></i>`, number === 0, () => fetchScheduleList(boardId, number - 1))
                );

                // Pages
                for (let i = 0; i < totalPages; i++) {
                    const btn = document.createElement("button");
                    btn.textContent = i + 1;
                    btn.className = `px-3 py-2 ${i === number ? "bg-primary text-white" : "text-gray-400 hover:text-white"} transition-colors`;
                    btn.onclick = () => fetchScheduleList(boardId, i);
                    container.appendChild(btn);
                }

                // Next
                container.appendChild(
                    makeBtn(`<i class="ri-arrow-right-line"></i>`, number >= totalPages - 1, () => fetchScheduleList(boardId, number + 1))
                );
            }

            // ✅ 삭제/수정(선택)
            async function deleteSchedule(scheduleId) {
                if (!confirm("일정을 삭제하시겠습니까?")) return;
                try {
                    const res = await fetch(`/api/v1/admin/school/schedule`, {
                        method: "DELETE",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ postId : scheduleId }),
                    });
                    const json = await res.json();
                    if (!json.isSuccess) throw new Error(json.message || "삭제 실패");
                    alert("삭제되었습니다.");
                    fetchScheduleList(window.currentBoardId, 0);
                } catch (e) {
                    console.error(e);
                    alert("서버 오류: " + e.message);
                }
            }

            // 수정 버튼 눌렀을 때: 모달 열고 값 세팅 (엔드포인트에 맞춰 구현)
            async function editSchedule(scheduleId) {
                try {
                    const res = await fetch(`/api/v1/admin/school/schedule?postId=${scheduleId}`);
                    const json = await res.json();
                    if (!json.isSuccess) throw new Error(json.message || "조회 실패");

                    const s = json.result;
                    document.getElementById("scheduleFrom").dataset.id = s.id;
                    document.getElementById("scheduleTitle").value = s.title || "";
                    document.getElementById("scheduleStartDate").value = (s.startDate || "").slice(0,10);
                    document.getElementById("scheduleEndDate").value   = (s.endDate || "").slice(0,10);
                    const r = document.querySelector(`input[name="scheduleType"][value="${s.type}"]`);
                    if (r) r.checked = true;

                    window.currentScheduleId = s.id;
                    openAddScheduleModal();
                } catch (e) {
                    console.error(e);
                    alert("서버 오류: " + e.message);
                }
            }

            // ✅ 필터 이벤트 바인딩 (변경 시 자동 조회)
            document.addEventListener("DOMContentLoaded", () => {
                const root = document.getElementById("schedule-list-editor");
                if (!root) return;

                const requery = () => fetchScheduleList(window.currentBoardId, 0);

                root.querySelector("#schedule-type-filter")?.addEventListener("change", requery);
                root.querySelector("#schedule-date-from")?.addEventListener("change", requery);
                root.querySelector("#schedule-date-to")?.addEventListener("change", requery);

                const search = root.querySelector("#schedule-search");
                if (search) {
                    let t;
                    search.addEventListener("input", () => {
                        clearTimeout(t);
                        t = setTimeout(requery, 300); // 간단 디바운스
                    });
                    search.addEventListener("keydown", (e) => {
                        if (e.key === "Enter") requery();
                    });
                }
            });
        </script>
        <div id="post-editor" class="hidden">
            <header class="mb-8">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <button
                                onclick="showBoardListEditor()"
                                class="mr-4 p-2 text-gray-400 hover:text-white transition-colors"
                        >
                            <div class="w-5 h-5 flex items-center justify-center">
                                <i class="ri-arrow-left-line"></i>
                            </div>
                        </button>
                        <div>
                            <h1
                                    class="text-3xl font-bold text-white"
                                    id="post-editor-title"
                            >
                                게시글 수정
                            </h1>
                            <p class="text-gray-400 mt-2">
                                게시글 내용을 수정하고 저장하세요
                            </p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button
                                onclick="showBoardListEditor()"
                                class="px-4 py-2 bg-gray-600 text-white rounded-button hover:bg-gray-500 transition-colors whitespace-nowrap"
                        >
                            취소
                        </button>
                        <button
                                onclick="savePost('TEMPORARY')"
                                class="px-4 py-2 bg-gray-700 text-white rounded-button hover:bg-gray-600 transition-colors whitespace-nowrap"
                        >
                            임시저장
                        </button>
                        <button
                                onclick="savePost('PUBLISHED')"
                                class="px-4 py-2 bg-primary text-white rounded-button hover:bg-blue-600 transition-colors whitespace-nowrap"
                        >
                            게시하기
                        </button>
                    </div>
                </div>
            </header>
            <div class="admin-card rounded-xl p-6">
                <div class="space-y-6">
                    <div class="grid grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2"
                            >제목</label
                            >
                            <input
                                    type="text"
                                    value="2025학년도 1학기 학사일정 안내"
                                    class="w-full bg-gray-700 text-white px-4 py-3 rounded-lg border-none"
                            />
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2"
                            >카테고리</label
                            >
                            <select
                                    class="w-full bg-gray-700 text-white px-4 py-3 rounded-lg border-none pr-8"
                            >
                                <option>일반</option>
                                <option>공지사항</option>
                            </select>
                        </div>
                    </div>
                    <div class="grid gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2"
                            >포스트 설명</label
                            >
                            <input
                                    type="text"
                                    value=""
                                    class="w-full bg-gray-700 text-white px-4 py-3 rounded-lg border-none"
                            />
                        </div>

                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2"
                        >내용</label
                        >
                        <textarea id="intro-editor" name="content"></textarea>
<!--                        텍스트 내용 들어가야함-->
                    </div>
                    <div>
                        <div class="space-y-3">
                            <input type="file" name="q2" data-index="1" id="file-input-1" data-type="file" accept=".pdf,.doc,.docx,.xls,.xlsx"  class="file-input sr-only">
                            <label for="file-input-1" class="flex items-center justify-center px-4 py-2 rounded-lg cursor-pointer hover:border-primary transition-colors bg-gray-700 text-gray-300">
                                <i class="ri-upload-2-line mr-2"></i>
                                <span class="">파일 선택 또는 드래그하여 업로드</span>
                            </label>
                            <div class="flex items-center gap-2 mt-2">
                                <div id="file-name-1" data-index="1" class=" file-name mt-2 text-sm text-gray-500"></div>
                                <button type="button" id="clear-file-1" class="text-red-500 hover:text-red-700 text-sm clear-btn hidden" data-index="1">✕</button>
                            </div>
                        </div>
                        <div class="space-y-3">
                            <input type="file" name="q2" id="file-input-2" data-index="2" data-type="file" accept=".pdf,.doc,.docx,.xls,.xlsx"  class="file-input sr-only">
                            <label for="file-input-2" class="flex items-center justify-center px-4 py-2 rounded-lg cursor-pointer hover:border-primary transition-colors bg-gray-700 text-gray-300">
                                <i class="ri-upload-2-line mr-2"></i>
                                <span class="">파일 선택 또는 드래그하여 업로드</span>
                            </label>
                            <div class="flex items-center gap-2 mt-2">
                                <div id="file-name-2" data-index="2" class=" file-name mt-2 text-sm text-gray-500"></div>
                                <button type="button" id="clear-file-2" class="text-red-500 hover:text-red-700 text-sm clear-btn hidden" data-index="2">✕</button>
                            </div>
                        </div>
                        <div class="space-y-3">
                            <input type="file" name="q2" id="file-input-3" data-index="3" data-type="file" accept=".pdf,.doc,.docx,.xls,.xlsx"  class="file-input sr-only">
                            <label for="file-input-3" class="flex items-center justify-center px-4 py-2 rounded-lg cursor-pointer hover:border-primary transition-colors bg-gray-700 text-gray-300">
                                <i class="ri-upload-2-line mr-2"></i>
                                <span class="">파일 선택 또는 드래그하여 업로드</span>
                            </label>
                            <div class="flex items-center gap-2 mt-2">
                                <div id="file-name-3" data-index="3" class=" file-name mt-2 text-sm text-gray-500"></div>
                                <button type="button" id="clear-file-3" class="text-red-500 hover:text-red-700 text-sm clear-btn hidden" data-index="3">✕</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="filePost-editor" class="hidden">
            <header class="mb-8">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <button
                                onclick="showBoardListEditor()"
                                class="mr-4 p-2 text-gray-400 hover:text-white transition-colors"
                        >
                            <div class="w-5 h-5 flex items-center justify-center">
                                <i class="ri-arrow-left-line"></i>
                            </div>
                        </button>
                        <div>
                            <h1
                                    class="text-3xl font-bold text-white"
                                    id="filePost-editor-title"
                            >
                                게시글 수정
                            </h1>
                            <p class="text-gray-400 mt-2">
                                게시글 내용을 수정하고 저장하세요
                            </p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button
                                onclick="showBoardListEditor()"
                                class="px-4 py-2 bg-gray-600 text-white rounded-button hover:bg-gray-500 transition-colors whitespace-nowrap"
                        >
                            취소
                        </button>
                        <button
                                onclick="saveFilePost('TEMPORARY')"
                                class="px-4 py-2 bg-gray-700 text-white rounded-button hover:bg-gray-600 transition-colors whitespace-nowrap"
                        >
                            임시저장
                        </button>
                        <button
                                onclick="saveFilePost('PUBLISHED')"
                                class="px-4 py-2 bg-primary text-white rounded-button hover:bg-blue-600 transition-colors whitespace-nowrap"
                        >
                            게시하기
                        </button>
                    </div>
                </div>
            </header>
            <div class="admin-card rounded-xl p-6">
                <div class="space-y-6">
                    <div class="grid grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2"
                            >제목</label
                            >
                            <input
                                    type="text"
                                    value=""
                                    class="w-full bg-gray-700 text-white px-4 py-3 rounded-lg border-none"
                            />
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2"
                            >카테고리</label
                            >
                            <select
                                    class="w-full bg-gray-700 text-white px-4 py-3 rounded-lg border-none pr-8"
                            >
                                <option>일반</option>
                                <option>공지사항</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <div class="space-y-3">
                            <input type="file" id="postFile-input" data-type="file" accept=".pdf,.doc,.docx,.xls,.xlsx"  class="file-input sr-only">
                            <label for="postFile-input" id = "postFile-label" class="flex items-center justify-center px-4 py-2 rounded-lg cursor-pointer hover:border-primary transition-colors bg-gray-700 text-gray-300">
                                <i class="ri-upload-2-line mr-2"></i>
                                <span class="">파일 선택 또는 드래그하여 업로드</span>
                            </label>
                            <div class="flex items-center gap-2 mt-2">
                                <div id="postFile-name" class=" file-name mt-2 text-sm text-gray-500"></div>
                                <button type="button" id="clear-postFile" class="text-red-500 hover:text-red-700 text-sm hidden">✕</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div
                id="addScheduleModal"
                class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50"
                data-schedule-id=""
        >
            <div class="bg-gray-800 rounded-xl p-6 w-[560px] shadow-2xl">
                <!-- 헤더 -->
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-bold text-white">새 일정 추가</h3>
                    <button
                            class="text-gray-400 hover:text-white transition-colors"
                            id="closeAddScheduleModalBtn"
                            aria-label="닫기"
                    >
                        <div class="w-6 h-6 flex items-center justify-center">
                            <i class="ri-close-line"></i>
                        </div>
                    </button>
                </div>

                <!-- 폼 필드 -->
                <div class="space-y-4">
                    <!-- 제목 -->
                    <div>
                        <label for="scheduleTitle" class="block text-sm font-medium text-gray-300 mb-2">
                            제목
                        </label>
                        <input
                                id="scheduleTitle"
                                type="text"
                                class="w-full bg-gray-700 text-white px-4 py-3 rounded-lg border-none"
                                placeholder="일정 제목을 입력하세요"
                        />
                    </div>

                    <!-- 날짜 -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label for="scheduleStartDate" class="block text-sm font-medium text-gray-300 mb-2">
                                시작 날짜
                            </label>
                            <input
                                    id="scheduleStartDate"
                                    type="date"
                                    class="w-full bg-gray-700 text-white px-4 py-3 rounded-lg border-none"
                            />
                        </div>
                        <div>
                            <label for="scheduleEndDate" class="block text-sm font-medium text-gray-300 mb-2">
                                끝 날짜
                            </label>
                            <input
                                    id="scheduleEndDate"
                                    type="date"
                                    class="w-full bg-gray-700 text-white px-4 py-3 rounded-lg border-none"
                            />
                        </div>
                    </div>

                    <!-- 게시판 타입 (라디오) -->
                    <div>
                        <span class="block text-sm font-medium text-gray-300 mb-2">게시판 타입</span>
                        <div class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                            <!-- ACADEMIC -->
                            <label class="relative flex items-center justify-center p-3 bg-gray-700 rounded-lg cursor-pointer group hover:bg-gray-600 transition-colors">
                                <input type="radio" name="scheduleType" value="ACADEMIC" class="sr-only peer" checked />
                                <div class="flex items-center gap-2 text-white">
                                    <i class="ri-graduation-cap-fill text-primary"></i>
                                    <span class="text-sm">ACADEMIC</span>
                                </div>
                                <div class="absolute inset-0 border-2 border-primary rounded-lg opacity-0 pointer-events-none group-hover:opacity-100 peer-checked:opacity-100"></div>
                            </label>

                            <!-- ADMISSION -->
                            <label class="relative flex items-center justify-center p-3 bg-gray-700 rounded-lg cursor-pointer group hover:bg-gray-600 transition-colors">
                                <input type="radio" name="scheduleType" value="ADMISSION" class="sr-only peer" />
                                <div class="flex items-center gap-2 text-white">
                                    <i class="ri-door-open-line text-primary"></i>
                                    <span class="text-sm">ADMISSION</span>
                                </div>
                                <div class="absolute inset-0 border-2 border-primary rounded-lg opacity-0 pointer-events-none group-hover:opacity-100 peer-checked:opacity-100"></div>
                            </label>

                            <!-- SCHOLARSHIP -->
                            <label class="relative flex items-center justify-center p-3 bg-gray-700 rounded-lg cursor-pointer group hover:bg-gray-600 transition-colors">
                                <input type="radio" name="scheduleType" value="SCHOLARSHIP" class="sr-only peer" />
                                <div class="flex items-center gap-2 text-white">
                                    <i class="ri-award-line text-primary"></i>
                                    <span class="text-sm">SCHOLARSHIP</span>
                                </div>
                                <div class="absolute inset-0 border-2 border-primary rounded-lg opacity-0 pointer-events-none group-hover:opacity-100 peer-checked:opacity-100"></div>
                            </label>

                            <!-- DORMITORY -->
                            <label class="relative flex items-center justify-center p-3 bg-gray-700 rounded-lg cursor-pointer group hover:bg-gray-600 transition-colors">
                                <input type="radio" name="scheduleType" value="DORMITORY" class="sr-only peer" />
                                <div class="flex items-center gap-2 text-white">
                                    <i class="ri-home-4-line text-primary"></i>
                                    <span class="text-sm">DORMITORY</span>
                                </div>
                                <div class="absolute inset-0 border-2 border-primary rounded-lg opacity-0 pointer-events-none group-hover:opacity-100 peer-checked:opacity-100"></div>
                            </label>

                            <!-- INTERNATIONAL -->
                            <label class="relative flex items-center justify-center p-3 bg-gray-700 rounded-lg cursor-pointer group hover:bg-gray-600 transition-colors">
                                <input type="radio" name="scheduleType" value="INTERNATIONAL" class="sr-only peer" />
                                <div class="flex items-center gap-2 text-white">
                                    <i class="ri-plane-line text-primary"></i>
                                    <span class="text-sm">INTERNATIONAL</span>
                                </div>
                                <div class="absolute inset-0 border-2 border-primary rounded-lg opacity-0 pointer-events-none group-hover:opacity-100 peer-checked:opacity-100"></div>
                            </label>
                        </div>
                        <p class="text-xs text-gray-400 mt-2">※ 위 값은 서버로 그대로 전달될 enum 문자열입니다.</p>
                    </div>
                </div>

                <div class="flex justify-end space-x-3 mt-6">
                    <button
                            class="px-4 py-2 bg-gray-700 text-white rounded-button hover:bg-gray-600 transition-colors whitespace-nowrap"
                            id="scheduleCancelBtn"
                    >
                        취소
                    </button>
                    <button
                            class="px-4 py-2 bg-primary text-white rounded-button hover:bg-blue-600 transition-colors whitespace-nowrap"
                            id="scheduleSubmitBtn"
                    >
                        추가하기
                    </button>
                </div>
            </div>
        </div>
    </main>
</div>
<script id="postSchedule">
    (function () {
        async function submitSchedule() {
            const btn   = document.getElementById("scheduleSubmitBtn");
            const modal = document.getElementById("addScheduleModal"); // 모달 루트 엘리먼트
            const isEdit = !!modal.dataset.scheduleId;

            const boardId   = Number(window.currentBoardId);
            const title     = document.getElementById("scheduleTitle").value.trim();
            const startDate = document.getElementById("scheduleStartDate").value; // YYYY-MM-DD
            const endDate   = document.getElementById("scheduleEndDate").value;   // YYYY-MM-DD or ""
            const type      = document.querySelector('input[name="scheduleType"]:checked')?.value || "ACADEMIC";

            // 기본 검증
            if (!boardId)   return alert("boardId가 없습니다.");
            if (!title)     return alert("제목을 입력하세요.");
            if (!startDate) return alert("시작 날짜를 선택하세요.");
            if (endDate && endDate < startDate) return alert("끝 날짜가 시작 날짜보다 빠릅니다.");

            // 공통 바디 (PATCH/POST 동일)
            const fd = new FormData();
            fd.append("boardId", String(boardId));
            fd.append("title", title);
            fd.append("startDate", startDate);
            if (endDate) fd.append("endDate", endDate);
            fd.append("type", type);
            if (isEdit) fd.append("scheduleId", modal.dataset.scheduleId);

            const url = "/api/v1/admin/school/schedule";   // PATCH/POST 동일 URL
            const method = isEdit ? "PATCH" : "POST";

            btn.disabled = true;
            try {
                const res = await fetch(url, { method, body: fd });
                const json = await res.json();
                if (!json.isSuccess) throw new Error(json.message || "저장 실패");

                alert(isEdit ? "일정을 수정했습니다." : "일정을 등록했습니다.");
                closeAddScheduleModal();               // 닫으면서 dataset.scheduleId 비우기
                await fetchScheduleList(boardId, 0);   // 목록 갱신 (프로젝트 함수에 맞게)
            } catch (e) {
                console.error(e);
                alert("오류: " + e.message);
            } finally {
                btn.disabled = false;
            }
        }

        // 버튼 클릭 바인딩 (위임)
        document.addEventListener("click", (e) => {
            if (e.target.closest("#scheduleSubmitBtn")) submitSchedule();
        });
    })();
</script>
<script id="board-management">
    document.addEventListener("DOMContentLoaded", function () {
        window.currentView = "board-list";
        window.currentBoardName = "";
        window.currentPostTitle = "";
        window.deleteBoard = async function (boardName, boardId) {
            if (confirm(`"${boardName}" 게시판을 삭제하시겠습니까?`)) {
                try {
                    const response = await fetch("/api/v1/admin/school/board", {
                        method: "DELETE",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({ boardId: boardId })
                    });

                    const result = await response.json();
                    if (result.isSuccess) {
                        // 알림 표시
                        const notification = document.createElement("div");
                        notification.className =
                            "fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50";
                        notification.textContent = "게시판이 삭제되었습니다";
                        document.body.appendChild(notification);

                        setTimeout(() => {
                            notification.remove();
                            location.reload(); // 새로고침
                        }, 1500);
                    } else {
                        alert("삭제 실패: " + result.message);
                    }
                } catch (e) {
                    console.error("삭제 오류:", e);
                    alert("오류가 발생했습니다.");
                }
            }
        };
    });
    function toggleSchool(schoolId) {
        console.log("school "+schoolId);
        const arrow = document.getElementById(schoolId + "-arrow");
        const children = document.getElementById(schoolId + "-children");
        const node = arrow.closest(".tree-node");
        if (node.classList.contains("expanded")) {
            node.classList.remove("expanded");
            arrow.style.transform = "rotate(0deg)";
        } else {
            node.classList.add("expanded");
            arrow.style.transform = "rotate(90deg)";
        }
    }
    function showBoardList() {
        document.getElementById("board-list-view").classList.remove("hidden");
        document.getElementById("intro-board-editor").classList.add("hidden");
        document.getElementById("board-list-editor").classList.add("hidden");
        document.getElementById("schedule-list-editor").classList.add("hidden");
        document.getElementById("post-editor").classList.add("hidden");
        document.getElementById("filePost-editor").classList.add("hidden");
        window.currentView = "board-list";
    }
    function editIntroBoard(boardName) {
        window.currentBoardName = boardName;
        document.getElementById("intro-board-title").textContent =
            boardName + " 수정";
        document.getElementById("board-list-view").classList.add("hidden");
        document.getElementById("intro-board-editor").classList.remove("hidden");
        document.getElementById("board-list-editor").classList.add("hidden");
        document.getElementById("schedule-list-editor").classList.add("hidden");
        document.getElementById("post-editor").classList.add("hidden");
        document.getElementById("filePost-editor").classList.add("hidden");
        window.currentView = "intro-editor";
    }

    function editBoardList(boardTitle, boardId, boardType) {
        window.currentBoardName = boardTitle;
        window.currentBoardId = boardId; // 전역에 저장
        window.currentBoardType = boardType;

        document.getElementById("board-list-title").textContent = boardTitle + " 관리";
        document.getElementById("board-list-title").dataset.type = boardType;

        document.getElementById("board-list-view").classList.add("hidden");
        document.getElementById("intro-board-editor").classList.add("hidden");
        document.getElementById("board-list-editor").classList.remove("hidden");
        document.getElementById("post-editor").classList.add("hidden");
        document.getElementById("filePost-editor").classList.add("hidden");
        window.currentView = "board-list-editor";

        fetchPostList(boardId, 0); // ← 게시판 ID로 목록 불러오기
    }

    //스케줄 목록 관리
    function editScheduleList(boardTitle, boardId, boardType) {
        window.currentBoardName = boardTitle;
        window.currentBoardId = boardId; // 전역에 저장
        window.currentBoardType = boardType;

        document.getElementById("board-list-title").textContent = boardTitle + " 관리";
        document.getElementById("board-list-title").dataset.type = boardType;

        document.getElementById("board-list-view").classList.add("hidden");
        document.getElementById("intro-board-editor").classList.add("hidden");
        document.getElementById("board-list-editor").classList.add("hidden");
        document.getElementById("schedule-list-editor").classList.remove("hidden");
        document.getElementById("post-editor").classList.add("hidden");
        document.getElementById("filePost-editor").classList.add("hidden");
        window.currentView = "board-list-editor";

        fetchScheduleList(boardId, 0); // ← 게시판 ID로 목록 불러오기
    }

    function showBoardListEditor() {
        resetFilePostEditor();
        window.currentPostId=null;
        document.getElementById("board-list-view").classList.add("hidden");
        document.getElementById("intro-board-editor").classList.add("hidden");
        document.getElementById("board-list-editor").classList.remove("hidden");
        document.getElementById("schedule-list-editor").classList.add("hidden");
        document.getElementById("post-editor").classList.add("hidden");
        document.getElementById("filePost-editor").classList.add("hidden");
        window.currentView = "board-list-editor";
    }
    async function editPost(postTitle, postId, type) {
        console.log(postTitle,postId);
        window.currentPostTitle = postTitle;
        console.log("editPost에서 "+window.currentPostTitle);
        console.log("type:",type);
        window.currentPostId = postId;
        try {
            const url = "/api/v1/admin/school/"+((type==="FILES")?"file":"post")+`?postId=${postId}`;
            const response = await fetch(url);

            const result = await response.json();
            console.log("값 가져옴");

            if (result.isSuccess) {
                const post = result.result.post;
                const files = result.result.file;

                if(type==="NOTICE"){
                    console.log("NOTICE타입");
                    // 1. 제목, 설명 세팅
                    const textInputs = document.querySelectorAll('#post-editor input[type="text"]');
                    textInputs[0].value = post.title;
                    textInputs[1].value = post.description;

                    // 2. 내용 세팅 (SunEditor)
                    editor.setContents(post.content);

                    // 3. 카테고리 설정 (select)
                    const type = post.type === 'NOTICE' ? '공지사항' : '일반';
                    const select = document.querySelector('#post-editor select');
                    for (let i = 0; i < select.options.length; i++) {
                        if (select.options[i].text === type) {
                            select.selectedIndex = i;
                            break;
                        }
                    }

                    //4.파일 가져온거 추가해주기
                    for (let i = 0; i < 3; i++) {
                        const nameDiv = document.getElementById(`file-name-${i + 1}`);
                        const input = document.getElementById(`file-input-${i + 1}`);

                        if (files[i]) {
                            nameDiv.textContent = `📎 ${files[i].name}`;
                            // 덮어쓴 파일 구분 위해 fileId 저장
                            input.dataset.existingFileId = files[i].fileId;
                            const clearButton = document.querySelector(`.clear-btn[data-index="${i+1}"]`);
                            clearButton.classList.remove("hidden");
                        } else {
                            nameDiv.textContent = "";
                            delete input.dataset.existingFileId;
                        }
                    }

                    // UI 보여주기
                    document.getElementById("post-editor-title").textContent = "게시글 수정 - " + post.title;
                    document.getElementById("board-list-view").classList.add("hidden");
                    document.getElementById("intro-board-editor").classList.add("hidden");
                    document.getElementById("board-list-editor").classList.add("hidden");
                    document.getElementById("schedule-list-editor").classList.add("hidden");
                    document.getElementById("post-editor").classList.remove("hidden");
                    document.getElementById("filePost-editor").classList.add("hidden");
                    window.currentView = "post-editor";
                }else if(type==="FILES"){
                    console.log("FILES타입");
                    const textInputs = document.querySelectorAll('#filePost-editor input[type="text"]');
                    textInputs[0].value = post.title;

                    // 3. 카테고리 설정 (select)
                    const type = post.type === 'NOTICE' ? '공지사항' : '일반';
                    const select = document.querySelector('#filePost-editor select');
                    for (let i = 0; i < select.options.length; i++) {
                        if (select.options[i].text === type) {
                            select.selectedIndex = i;
                            break;
                        }
                    }

                    const nameDiv = document.getElementById(`postFile-name`);
                    const input =document.getElementById(`postFile-input`);
                    if(files){
                        nameDiv.textContent = `📎 ${files.name}`;
                        // 덮어쓴 파일 구분 위해 fileId 저장
                        input.dataset.existingFileId = files.fileId;
                        const clearBtn = document.getElementById("clear-postFile");
                        clearBtn.classList.remove("hidden");
                    }else{
                        nameDiv.textContent = "";
                        delete input.dataset.existingFileId;
                    }

                    // UI 보여주기
                    document.getElementById("post-editor-title").textContent = "게시글 수정 - " + post.title;
                    document.getElementById("board-list-view").classList.add("hidden");
                    document.getElementById("intro-board-editor").classList.add("hidden");
                    document.getElementById("board-list-editor").classList.add("hidden");
                    document.getElementById("schedule-list-editor").classList.add("hidden");
                    document.getElementById("post-editor").classList.add("hidden");
                    document.getElementById("filePost-editor").classList.remove("hidden");
                    window.currentView = "post-editor";
                }
            } else {
                alert("게시글 정보를 불러오지 못했습니다.");
                window.currentPostId = null;
            }

        } catch (e) {
            console.error("게시글 불러오기 오류:", e);
            alert("서버 오류가 발생했습니다.");
        }
    }

    function createNewPost() {
        document.getElementById("post-editor-title").textContent = "새 게시글 작성";
        const type = window.currentBoardType
        console.log("createNewPost type:",type);
        document.querySelector('#post-editor input[type="text"]').value = "";
        document.querySelector("#post-editor textarea").value = "";

        document.getElementById("board-list-view").classList.add("hidden");
        document.getElementById("intro-board-editor").classList.add("hidden");
        document.getElementById("board-list-editor").classList.add("hidden");
        document.getElementById("schedule-list-editor").classList.add("hidden");

        if(type==="NOTICE"){
            document.getElementById("post-editor").classList.remove("hidden");
            document.getElementById("filePost-editor").classList.add("hidden");
            window.currentView = "post-editor";
        }else{
            document.getElementById("filePost-editor").classList.remove("hidden");
            document.getElementById("post-editor").classList.add("hidden");
            window.currentView = "filePost-editor";
        }
    }

    function saveIntroBoard() {
        alert("소개페이지가 저장되었습니다.");
        showBoardList();
    }

    const clearButtons = document.querySelectorAll('.clear-btn');
    const fileInputs = [
        document.getElementById("file-input-1"),
        document.getElementById("file-input-2"),
        document.getElementById("file-input-3")
    ];

    clearButtons.forEach(button => {
        button.addEventListener('click', () => {
            console.log("초기화 클릭");
            const index = button.dataset.index;
            const fileInput = document.querySelector(`.file-input[data-index="${index}"]`);
            const fileNameDisplay = document.querySelector(`.file-name[data-index="${index}"]`);

            fileInput.value = '';
            fileNameDisplay.textContent = '';
            button.classList.add('hidden');
        });
    });

    async function savePost(status) {
        const boardId = Number(window.currentBoardId);
        const title = document.querySelector('#post-editor input[type="text"]').value.trim();
        const description = document.querySelectorAll('#post-editor input[type="text"]')[1].value.trim();
        const content = editor.getContents();
        const category = document.querySelector('#post-editor select').value;
        const type = category === '공지사항' ? 'NOTICE' : 'NORMAL';

        const formData = new FormData();
        formData.append("boardId", boardId);
        formData.append("title", title);
        formData.append("description", description);
        formData.append("content", content);
        formData.append("status", status);
        formData.append("type", type);

        const filesToDelete = [];

        fileInputs.forEach(input => {
            const existingFileId = input.dataset.existingFileId;
            const index = input.dataset.index;
            const fileNameDisplay = document.querySelector(`.file-name[data-index="${index}"]`);

            if (input.files.length > 0) {
                formData.append("files", input.files[0]);
                if (existingFileId) {
                    filesToDelete.push(existingFileId);
                }
            }else if (existingFileId && (!fileNameDisplay.textContent || fileNameDisplay.textContent.trim() === '')) {
                filesToDelete.push(existingFileId);
            }
        });

        filesToDelete.forEach(fileId => {
            formData.append("deleteFileIds", fileId);
        });

        try {
            if (window.currentPostId) {
                formData.append("postId", window.currentPostId);
            }
            const response = await fetch("/api/v1/admin/school/post", {
                method: window.currentPostId ? "PATCH" : "POST",
                body: formData
            });

            const result = await response.json();
            window.currentPostId=null;

            if (result.isSuccess) {
                alert("게시글이 저장되었습니다.");
                resetPostEditor();
                await fetchPostList(boardId, 0); // ← 게시판 ID로 목록 불러오기
                showBoardListEditor();
            } else {
                throw new Error(result.message || "저장 실패");
            }
        } catch (e) {
            console.error(e);
            alert("오류 발생: " + e.message);
        }
    }

    async function saveFilePost(status) {

        console.log("saveFilePost");

        const boardId = Number(window.currentBoardId);

        const title = document.querySelector('#filePost-editor input[type="text"]').value.trim();
        const category = document.querySelector('#filePost-editor select').value;
        const type = category === '공지사항' ? 'NOTICE' : 'NORMAL';

        const formData = new FormData();
        formData.append("boardId", boardId);
        formData.append("title", title);
        formData.append("status", status);
        formData.append("type", type);

        let filesToDelete;

        const fileInput = document.getElementById("postFile-input");

        console.log("fileInput",fileInput);

        if(fileInput){
            const existingFileId = fileInput.dataset.existingFileId;
            const fileNameDisplay = document.getElementById(`postFile-name`);

            if(fileInput.files.length>0){
                formData.append("files", fileInput.files[0]);
                if(existingFileId){
                    filesToDelete=existingFileId;
                }else if (existingFileId && (!fileNameDisplay.textContent || fileNameDisplay.textContent.trim() === '')) {
                    filesToDelete=existingFileId;
                }
            }
        }

        formData.append("deleteFileIds", filesToDelete);

        try {
            if (window.currentPostId) {
                formData.append("postId", window.currentPostId);
            }

            console.log("forData:",formData);

            const response = await fetch("/api/v1/admin/school/file", {
                method: window.currentPostId ? "PATCH" : "POST",
                body: formData
            });

            const result = await response.json();
            window.currentPostId=null;

            if (result.isSuccess) {
                alert("게시글이 저장되었습니다.");
                resetFilePostEditor();
                await fetchPostList(boardId, 0); // ← 게시판 ID로 목록 불러오기
                showBoardListEditor();
            } else {
                throw new Error(result.message || "저장 실패");
                console.log("저장 실패");
            }
        } catch (e) {
            console.error(e);
            alert("오류 발생: " + e.message);
        }
    }
</script>
<script id="toggle-switches">
    document.addEventListener("DOMContentLoaded", function () {
        const toggles = document.querySelectorAll('input[type="checkbox"]');
        toggles.forEach((toggle) => {
            const toggleContainer = toggle.nextElementSibling;
            const toggleBg = toggleContainer.querySelector("div:first-child");
            const toggleThumb = toggleContainer.querySelector("div:last-child");
            toggle.addEventListener("change", function () {
                if (this.checked) {
                    toggleBg.classList.remove("bg-gray-600");
                    toggleBg.classList.add("bg-primary");
                    toggleThumb.classList.add("translate-x-5");
                } else {
                    toggleBg.classList.remove("bg-primary");
                    toggleBg.classList.add("bg-gray-600");
                    toggleThumb.classList.remove("translate-x-5");
                }
            });
        });
        const boardTypeRadios = document.querySelectorAll('input[name="boardType"]');
        boardTypeRadios.forEach((radio) => {
            radio.addEventListener("change", function () {
                const labels = document.querySelectorAll("label.relative");
                labels.forEach((label) => {
                    const border = label.querySelector(".absolute");
                    if (label.contains(this)) {
                        border.classList.remove("opacity-0");
                        border.classList.add("opacity-100");
                    } else {
                        border.classList.remove("opacity-100");
                        border.classList.add("opacity-0");
                    }
                });
            });
        });
    });
</script>
<script>
    function submitAddCategory() {
        const modal = document.getElementById("addCategoryModal");
        const schoolId = modal.dataset.schoolId;

        const boardTitle = document.querySelector('input[placeholder="카테고리 이름을 입력하세요"]').value;
        const boardDescription = document.querySelectorAll('input[placeholder="카테고리 이름을 입력하세요"]')[1].value;

        const boardTypeValue = document.querySelector('input[name="boardType"]:checked').value;

        console.log("boardType:",boardTypeValue);

        let boardType;
        if (boardTypeValue === "intro") boardType = "intro";
        else if (boardTypeValue === "files") boardType = "files";
        else if (boardTypeValue === "schedule") boardType = "schedule";
        else boardType = "notice"; // 기본값

        const data = {
            schoolId: Number(schoolId),
            boardTitle: boardTitle,
            realTitle: boardTitle, // 필요시 다른 값으로 수정
            boardDescription: boardDescription,
            boardType: boardType
        };

        fetch("/api/v1/admin/school/board", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(data)
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error("카테고리 추가에 실패했습니다.");
                }
                return response.json();
            })
            .then(result => {
                alert("카테고리가 성공적으로 추가되었습니다.");
                window.location.href = "/admin/school";
            })
            .catch(error => {
                console.error(error);
                alert("에러 발생: " + error.message);
            });
    }
</script>
<script>
    function renderPagination(pageData, boardId) {
        const paginationContainer = document.getElementById("pagination");
        console.log(paginationContainer+"가져옴");
        paginationContainer.innerHTML = "";

        const { totalPages, number } = pageData;

        // fix 새 카테고리 추가에 버튼이 생김

        // 이전 버튼
        const prev = document.createElement("button");
        prev.innerHTML = `<i class="ri-arrow-left-line"></i>`;
        prev.className = "px-3 py-2 text-gray-400 hover:text-white transition-colors";
        prev.disabled = number === 0;
        prev.onclick = () => fetchPostList(boardId, number - 1);
        paginationContainer.appendChild(prev);

        for (let i = 0; i < totalPages; i++) {
            const btn = document.createElement("button");
            btn.textContent = i + 1;
            btn.className = `px-3 py-2 ${i === number ? 'bg-primary text-white' : 'text-gray-400 hover:text-white'}`;
            btn.onclick = () => fetchPostList(boardId, i);
            paginationContainer.appendChild(btn);
        }

        // 다음 버튼
        const next = document.createElement("button");
        next.innerHTML = `<i class="ri-arrow-right-line"></i>`;
        next.className = "px-3 py-2 text-gray-400 hover:text-white transition-colors";
        next.disabled = number >= totalPages - 1;
        next.onclick = () => fetchPostList(boardId, number + 1);
        paginationContainer.appendChild(next);
    }

    function renderPostTable(posts) {
        const tbody = document.getElementById("post-table-body");
        console.log("tbody:"+tbody);
        tbody.innerHTML = ''; // 기존  테이블 비우기

        posts.forEach(post => {
            const id = post.id;
            const isNotice = post.type === "NOTICE";
            const isTemp = post.status === "TEMPORARY";

            const row = document.createElement("tr");
            row.className = "table-row border-b border-gray-700";

            row.innerHTML = `
        <td class="p-3">
            <div class="flex items-center">
                ${isNotice ? '<span class="status-badge px-2 py-1 bg-red-500 bg-opacity-20 text-red-400 text-xs rounded-full mr-3">공지</span>' : ''}
                <span class="text-white">${post.title}</span>
            </div>
        </td>
        <td class="p-3 text-gray-300">${post.writer || '관리자'}</td>
        <td class="p-3 text-gray-400">${post.createdAt || '-'}</td>
        <td class="p-3 text-gray-300">${post.views}</td>
        <td class="p-3">
            <span class="status-badge px-2 py-1 ${isTemp ? 'bg-yellow-500 text-yellow-400' : 'bg-green-500 text-green-400'} bg-opacity-20 text-xs rounded-full">
                ${isTemp ? '임시저장' : '게시중'}
            </span>
        </td>
        <td class="p-3">
            <div class="flex space-x-2">
                <button
                    data-post-title="${post.title}"
                    data-post-id="${post.id}"
                    data-post-type="${post.postType}"
                    onclick="editPost(this.dataset.postTitle, this.dataset.postId, this.dataset.postType)"
                    class="px-3 py-1 bg-primary text-white text-sm rounded-button hover:bg-blue-600 transition-colors whitespace-nowrap">
                    수정
                </button>
                <button
                data-post-type="${post.postType}"
                data-post-id="${post.id}"
                onclick="deletePost(this.dataset.postId,this.dataset.postType)" class="px-3 py-1 bg-red-600 text-white text-sm rounded-button hover:bg-red-700 transition-colors whitespace-nowrap">삭제</button>
            </div>
        </td>
    `;
            tbody.appendChild(row);
        });
    }

    async function deletePost(postId,type) {
        if (!confirm("정말 삭제하시겠습니까?")) return;

        console.log("postId:",postId);
        try {
            const url = "/api/v1/admin/school/"+((type==="NOTICE")?"post":"file");
            console.log("type:",type);
            console.log("url:",url);
            const response = await fetch(url, {
                method: "DELETE",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ postId })
            });

            const result = await response.json();
            if (result.isSuccess) {
                alert("삭제 완료되었습니다.");
                fetchPostList(window.currentBoardId); // 삭제 후 리스트 다시 불러오기
            } else {
                alert("삭제 실패: " + result.message);
            }
        } catch (e) {
            console.error(e);
            alert("서버 오류: 삭제 요청 실패");
        }
    }

    async function fetchPostList(boardId, page = 0) {
        const status = document.querySelector("#board-list-editor select").value; // 필터 (예: 전체, PUBLISHED, TEMP)
        const keyword = document.querySelector("#board-list-editor input[type='text']").value.trim();

        const statusMap = {
            "일반": "NORMAL",
            "공지": "NOTICE",
            "전체": "ALL"
        };

        const params = new URLSearchParams({
            boardId: boardId,
            page: page,
            size: 10,
            keyword: keyword,
            status: statusMap[status] ?? null
        });

        try {
            const response = await fetch(`/api/v1/admin/school/posts?${params.toString()}`);
            const result = await response.json();
            console.log("값 가져옴");
            if (result.isSuccess) {
                console.log("데이터:"+result.result.content);
                renderPostTable(result.result.content); // 리스트 렌더링
                renderPagination(result.result, boardId); // 페이징 렌더링
            } else {
                alert("게시글 목록 불러오기 실패: " + result.message);
            }
        } catch (e) {
            console.error(e);
            alert("서버 오류 발생");
        }
    }
</script>
<script id="textEdit">
            const editor = SUNEDITOR.create('intro-editor', {
                lang: SUNEDITOR_LANG['ko'],
                height: '300px',
                width: '100%',
                placeholder: '학교 소개 내용을 입력하세요...',
                buttonList: [
                    ['undo', 'redo', 'formatBlock', 'fontSize', 'bold', 'underline', 'italic', 'strike',
                        'fontColor', 'hiliteColor', 'align', 'list', 'table', 'link', 'image', 'codeView']
                ],
                imageUploadUrl: '/api/v1/file/school',
                withCredentials: true,
                imageUploadName: 'file',
                imageMultipleFile: false
            });
</script>
<script>
    const introEditor = SUNEDITOR.create('school-intro-editor', {
        lang: SUNEDITOR_LANG['ko'],
        height: '300px', // 기본 높이 고정
        width: '100%',
        autoHeight: false, // 자동 증가 비활성화
        iframe: false,
        placeholder: '학교 소개 내용을 입력하세요...',
        buttonList: [
            ['undo', 'redo', 'formatBlock', 'fontSize', 'bold', 'underline', 'italic', 'strike',
                'fontColor', 'hiliteColor', 'align', 'list', 'table', 'link', 'image', 'codeView']
        ],
        imageUploadUrl: '/api/v1/file/school',
        withCredentials: true,
        imageUploadName: 'file',
        imageMultipleFile: false
    });
    function resizeEditorHeight() {
        const height = window.innerWidth < 640 ? 250 : 400; // 모바일 250px, 데스크탑 400px 등
        introEditor.setOptions({ height: `${height}px` });
    }

    window.addEventListener('load', resizeEditorHeight);
    window.addEventListener('resize', resizeEditorHeight);
</script>
<script>
    // 파일 입력
    document.querySelectorAll('input[type="file"]').forEach((fileInput) => {
        const type = fileInput.dataset.type; // file or image
        const container = fileInput.closest('.space-y-3');
        const fileNameDisplay = type === "image"
            ? container?.querySelector('.image-input')
            : container?.querySelector('.file-name, #postFile-name');

        if (fileNameDisplay) {
            fileInput.addEventListener("change", function () {
                const index = fileInput.dataset.index;
                const clearButton = document.querySelector(`.clear-btn[data-index="${index}"], #clear-postFile`);

                    fileNameDisplay.textContent = this.files.length > 0
                        ? `선택된 파일: ${this.files[0].name}`
                        : '';

                if (clearButton) {
                    clearButton.classList.remove('hidden');
                }
            });
        }
    });

    function resetPostEditor() {
        // 제목, 설명 초기화
        const textInputs = document.querySelectorAll('#post-editor input[type="text"]');
        textInputs.forEach(input => input.value = "");

        // SunEditor 내용 초기화
        editor.setContents("");

        // 카테고리 select 초기화
        document.querySelector('#post-editor select').selectedIndex = 0;

        // 파일 input 초기화
        for (let i = 1; i <= 3; i++) {
            const input = document.getElementById(`file-input-${i}`);
            if (input) input.value = "";
            const label = document.getElementById(`file-name-${i}`);
            if (label) label.textContent = "";
        }

    }
    function resetFilePostEditor() {
        // 제목, 설명 초기화
        const textInputs = document.querySelectorAll('#filePost-editor input[type="text"]');
        textInputs.forEach(input => input.value = "");

        // 카테고리 select 초기화
        document.querySelector('#filePost-editor select').selectedIndex = 0;
        //파일 초기화
        const input = document.getElementById(`postFile-input`);
        if (input) input.value = "";
        const nameDiv = document.getElementById(`postFile-name`);
        if(nameDiv) nameDiv.textContent = "";
        const clearBtn = document.getElementById(`clear-postFile`);
        if(clearBtn) clearBtn.classList.add("hidden");

    }
</script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const boardTypeRadios = document.querySelectorAll('input[name="boardType"]');

        boardTypeRadios.forEach((radio) => {
            radio.addEventListener("change", function () {
                const allLabels = document.querySelectorAll('label.relative');
                allLabels.forEach((label) => {
                    const border = label.querySelector(".absolute");
                    border.classList.remove("opacity-100");
                    border.classList.add("opacity-0");
                });

                const selectedLabel = this.closest("label.relative");
                const border = selectedLabel.querySelector(".absolute");
                border.classList.remove("opacity-0");
                border.classList.add("opacity-100");
            });
        });
    });
</script>

</body>
</html>
