<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>학교 소개 편집</title>
    <link href="https://cdn.jsdelivr.net/npm/suneditor@latest/dist/css/suneditor.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/suneditor@latest/dist/suneditor.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/suneditor@latest/src/lang/ko.js"></script>
</head>
<body style="padding: 20px; font-family: Arial, sans-serif;">

<h2 style="margin-bottom: 10px;">학교 소개 편집</h2>

<!-- 에디터를 붙일 텍스트 영역 -->
<textarea id="intro-editor" name="content"></textarea>

<button id="file-upload-btn" type="button" style="margin-top: 10px;">📎 파일 첨부</button>
<input type="file" id="file-input" style="display:none" multiple />

<!-- 저장 버튼 -->
<button id="save-button" style="margin-top: 20px; padding: 10px 20px; background-color: #3B82F6; color: white; border: none; border-radius: 4px;">
    저장하기
</button>

<script>
    // SunEditor 초기화
    const editor = SUNEDITOR.create('intro-editor', {
        lang: SUNEDITOR_LANG['ko'],
        height: '300px',
        width: '100%',
        placeholder: '학교 소개 내용을 입력하세요...',
        buttonList: [
            ['undo', 'redo', 'formatBlock', 'fontSize', 'bold', 'underline', 'italic', 'strike',
                'fontColor', 'hiliteColor', 'align', 'list', 'table', 'link', 'image', 'codeView']
        ]
    });

    // 1. 기존 학교 소개 내용 불러오기
    window.addEventListener("DOMContentLoaded", function () {
        fetch("/api/school/intro")
            .then(response => response.text())
            .then(data => {
                editor.setContents(data); // 에디터에 내용 설정
            })
            .catch(err => {
                alert("내용을 불러오는 중 오류가 발생했습니다.");
                console.error(err);
            });
    });

    // 2. 저장 버튼 클릭 시 내용 전송
    document.getElementById("save-button").addEventListener("click", function () {
        const content = editor.getContents(); // 에디터에서 HTML 가져옴

        fetch("/api/school/intro", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ content: content })
        })
            .then(response => {
                if (response.ok) {
                    alert("저장되었습니다.");
                } else {
                    throw new Error("저장 실패");
                }
            })
            .catch(err => {
                alert("저장 중 오류가 발생했습니다.");
                console.error(err);
            });
    });

    // 파일 첨부 (여러 개)
    const fileInput = document.getElementById("file-input");
    const fileBtn = document.getElementById("file-upload-btn");
    const uploadedFiles = []; // 여기에 { url, name } 형태로 저장
    fileBtn.addEventListener("click", () => fileInput.click());

    fileInput.addEventListener("change", function () {
        const files = Array.from(this.files);
        if (files.length === 0) return;

        files.forEach(file => {
            const formData = new FormData();
            formData.append("file", file);

            fetch("/api/upload/file", {
                method: "POST",
                body: formData
            })
                .then(res => res.json())
                .then(data => {
                    uploadedFiles.push({
                        url: data.url,
                        name: file.name
                    });

                    // 미리보기 표시 (선택 사항)
                    const preview = document.createElement("div");
                    preview.innerText = `📎 ${file.name}`;
                    document.body.appendChild(preview); // 예시로 body에 추가
                })
                .catch(err => {
                    alert("파일 업로드 실패: " + file.name);
                    console.error(err);
                });
        });

        this.value = "";
    });
</script>
</body>
</html>