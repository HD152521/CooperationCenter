<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>í•™êµ ì†Œê°œ í¸ì§‘</title>
    <link href="https://cdn.jsdelivr.net/npm/suneditor@latest/dist/css/suneditor.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/suneditor@latest/dist/suneditor.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/suneditor@latest/src/lang/ko.js"></script>
    <style>
        @font-face {
            font-family: 'SourceHanSansCN';
            src: url('/fonts/SourceHanSansSC-Regular-2.woff') format('woff2');
            font-weight: 400;
            font-style: normal;
            font-display: swap;
        }
        body {
            font-family: 'SourceHanSansCN', system-ui, -apple-system, BlinkMacSystemFont,
            'Segoe UI', sans-serif;
        }

    </style>
</head>
<body style="padding: 20px; font-family: Arial, sans-serif;">
<p>æ€æºé»‘ä½“  asdf</p>
<h2 style="margin-bottom: 10px;">í•™êµ ì†Œê°œ í¸ì§‘</h2>

<!-- ì—ë””í„°ë¥¼ ë¶™ì¼ í…ìŠ¤íŠ¸ ì˜ì—­ -->
<textarea id="intro-editor" name="content"></textarea>

<button id="file-upload-btn" type="button" style="margin-top: 10px;">ğŸ“ íŒŒì¼ ì²¨ë¶€</button>
<input type="file" id="file-input" style="display:none" multiple />

<!-- ì €ì¥ ë²„íŠ¼ -->
<button id="save-button" style="margin-top: 20px; padding: 10px 20px; background-color: #3B82F6; color: white; border: none; border-radius: 4px;">
    ì €ì¥í•˜ê¸°
</button>

<script>
    // SunEditor ì´ˆê¸°í™”
    const editor = SUNEDITOR.create('intro-editor', {
        lang: SUNEDITOR_LANG['ko'],
        height: '300px',
        width: '100%',
        placeholder: 'í•™êµ ì†Œê°œ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”...',
        buttonList: [
            ['undo', 'redo', 'formatBlock', 'fontSize', 'bold', 'underline', 'italic', 'strike',
                'fontColor', 'hiliteColor', 'align', 'list', 'table', 'link', 'image', 'codeView']
        ]
    });

    // 1. ê¸°ì¡´ í•™êµ ì†Œê°œ ë‚´ìš© ë¶ˆëŸ¬ì˜¤ê¸°
    window.addEventListener("DOMContentLoaded", function () {
        fetch("/api/school/intro")
            .then(response => response.text())
            .then(data => {
                editor.setContents(data); // ì—ë””í„°ì— ë‚´ìš© ì„¤ì •
            })
            .catch(err => {
                alert("ë‚´ìš©ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                console.error(err);
            });
    });

    // 2. ì €ì¥ ë²„íŠ¼ í´ë¦­ ì‹œ ë‚´ìš© ì „ì†¡
    document.getElementById("save-button").addEventListener("click", function () {
        const content = editor.getContents(); // ì—ë””í„°ì—ì„œ HTML ê°€ì ¸ì˜´

        fetch("/api/school/intro", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ content: content })
        })
            .then(response => {
                if (response.ok) {
                    alert("ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
                } else {
                    throw new Error("ì €ì¥ ì‹¤íŒ¨");
                }
            })
            .catch(err => {
                alert("ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                console.error(err);
            });
    });

    // íŒŒì¼ ì²¨ë¶€ (ì—¬ëŸ¬ ê°œ)
    const fileInput = document.getElementById("file-input");
    const fileBtn = document.getElementById("file-upload-btn");
    const uploadedFiles = []; // ì—¬ê¸°ì— { url, name } í˜•íƒœë¡œ ì €ì¥
    fileBtn.addEventListener("click", () => fileInput.click());

    fileInput.addEventListener("change", function () {
        const files = Array.from(this.files);
        if (files.length === 0) return;

        files.forEach(file => {
            const formData = new FormData();
            formData.append("file", file);

            fetch("/api/upload/file", {
                method: "POST",
                body: formData
            })
                .then(res => res.json())
                .then(data => {
                    uploadedFiles.push({
                        url: data.url,
                        name: file.name
                    });

                    // ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ (ì„ íƒ ì‚¬í•­)
                    const preview = document.createElement("div");
                    preview.innerText = `ğŸ“ ${file.name}`;
                    document.body.appendChild(preview); // ì˜ˆì‹œë¡œ bodyì— ì¶”ê°€
                })
                .catch(err => {
                    alert("íŒŒì¼ ì—…ë¡œë“œ ì‹¤íŒ¨: " + file.name);
                    console.error(err);
                });
        });

        this.value = "";
    });
</script>
</body>
</html>